{"ast":null,"code":"import base64 from 'base64-js';\nimport sha256 from 'js-sha256';\n/*\n * Copyright 2016 Red Hat, Inc. and/or its affiliates\n * and other contributors as indicated by the @author tags.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nif (typeof Promise === 'undefined') {\n  throw Error('Keycloak requires an environment that supports Promises. Make sure that you include the appropriate polyfill.');\n}\n\nvar loggedConstructorDeprecation = false;\n\nfunction logConstructorDeprecation() {\n  if (!loggedConstructorDeprecation) {\n    loggedConstructorDeprecation = true;\n    console.warn('[KEYCLOAK] Instantiation using the `Keycloak` function has been deprecated and support will be removed in future versions. Use the `new` operator to create an instance instead.');\n  }\n}\n\nvar loggedPromiseDeprecation = false;\n\nfunction logPromiseDeprecation() {\n  if (!loggedPromiseDeprecation) {\n    loggedPromiseDeprecation = true;\n    console.warn('[KEYCLOAK] Usage of legacy style promise methods such as `.error()` and `.success()` has been deprecated and support will be removed in future versions. Use standard style promise methods such as `.then() and `.catch()` instead.');\n  }\n}\n\nfunction Keycloak(config) {\n  if (!(this instanceof Keycloak)) {\n    logConstructorDeprecation();\n    return new Keycloak(config);\n  }\n\n  var kc = this;\n  var adapter;\n  var refreshQueue = [];\n  var callbackStorage;\n  var loginIframe = {\n    enable: true,\n    callbackList: [],\n    interval: 5\n  };\n  var scripts = document.getElementsByTagName('script');\n\n  for (var i = 0; i < scripts.length; i++) {\n    if ((scripts[i].src.indexOf('keycloak.js') !== -1 || scripts[i].src.indexOf('keycloak.min.js') !== -1) && scripts[i].src.indexOf('version=') !== -1) {\n      kc.iframeVersion = scripts[i].src.substring(scripts[i].src.indexOf('version=') + 8).split('&')[0];\n    }\n  }\n\n  var useNonce = true;\n  var logInfo = createLogger(console.info);\n  var logWarn = createLogger(console.warn);\n\n  kc.init = function (initOptions) {\n    kc.authenticated = false;\n    callbackStorage = createCallbackStorage();\n    var adapters = ['default', 'cordova', 'cordova-native'];\n\n    if (initOptions && adapters.indexOf(initOptions.adapter) > -1) {\n      adapter = loadAdapter(initOptions.adapter);\n    } else if (initOptions && typeof initOptions.adapter === \"object\") {\n      adapter = initOptions.adapter;\n    } else {\n      if (window.Cordova || window.cordova) {\n        adapter = loadAdapter('cordova');\n      } else {\n        adapter = loadAdapter();\n      }\n    }\n\n    if (initOptions) {\n      if (typeof initOptions.useNonce !== 'undefined') {\n        useNonce = initOptions.useNonce;\n      }\n\n      if (typeof initOptions.checkLoginIframe !== 'undefined') {\n        loginIframe.enable = initOptions.checkLoginIframe;\n      }\n\n      if (initOptions.checkLoginIframeInterval) {\n        loginIframe.interval = initOptions.checkLoginIframeInterval;\n      }\n\n      if (initOptions.onLoad === 'login-required') {\n        kc.loginRequired = true;\n      }\n\n      if (initOptions.responseMode) {\n        if (initOptions.responseMode === 'query' || initOptions.responseMode === 'fragment') {\n          kc.responseMode = initOptions.responseMode;\n        } else {\n          throw 'Invalid value for responseMode';\n        }\n      }\n\n      if (initOptions.flow) {\n        switch (initOptions.flow) {\n          case 'standard':\n            kc.responseType = 'code';\n            break;\n\n          case 'implicit':\n            kc.responseType = 'id_token token';\n            break;\n\n          case 'hybrid':\n            kc.responseType = 'code id_token token';\n            break;\n\n          default:\n            throw 'Invalid value for flow';\n        }\n\n        kc.flow = initOptions.flow;\n      }\n\n      if (initOptions.timeSkew != null) {\n        kc.timeSkew = initOptions.timeSkew;\n      }\n\n      if (initOptions.redirectUri) {\n        kc.redirectUri = initOptions.redirectUri;\n      }\n\n      if (initOptions.silentCheckSsoRedirectUri) {\n        kc.silentCheckSsoRedirectUri = initOptions.silentCheckSsoRedirectUri;\n      }\n\n      if (typeof initOptions.silentCheckSsoFallback === 'boolean') {\n        kc.silentCheckSsoFallback = initOptions.silentCheckSsoFallback;\n      } else {\n        kc.silentCheckSsoFallback = true;\n      }\n\n      if (initOptions.pkceMethod) {\n        if (initOptions.pkceMethod !== \"S256\") {\n          throw 'Invalid value for pkceMethod';\n        }\n\n        kc.pkceMethod = initOptions.pkceMethod;\n      }\n\n      if (typeof initOptions.enableLogging === 'boolean') {\n        kc.enableLogging = initOptions.enableLogging;\n      } else {\n        kc.enableLogging = false;\n      }\n\n      if (typeof initOptions.scope === 'string') {\n        kc.scope = initOptions.scope;\n      }\n\n      if (typeof initOptions.messageReceiveTimeout === 'number' && initOptions.messageReceiveTimeout > 0) {\n        kc.messageReceiveTimeout = initOptions.messageReceiveTimeout;\n      } else {\n        kc.messageReceiveTimeout = 10000;\n      }\n    }\n\n    if (!kc.responseMode) {\n      kc.responseMode = 'fragment';\n    }\n\n    if (!kc.responseType) {\n      kc.responseType = 'code';\n      kc.flow = 'standard';\n    }\n\n    var promise = createPromise();\n    var initPromise = createPromise();\n    initPromise.promise.then(function () {\n      kc.onReady && kc.onReady(kc.authenticated);\n      promise.setSuccess(kc.authenticated);\n    }).catch(function (error) {\n      promise.setError(error);\n    });\n    var configPromise = loadConfig();\n\n    function onLoad() {\n      var doLogin = function (prompt) {\n        if (!prompt) {\n          options.prompt = 'none';\n        }\n\n        kc.login(options).then(function () {\n          initPromise.setSuccess();\n        }).catch(function (error) {\n          initPromise.setError(error);\n        });\n      };\n\n      var checkSsoSilently = function () {\n        var ifrm = document.createElement(\"iframe\");\n        var src = kc.createLoginUrl({\n          prompt: 'none',\n          redirectUri: kc.silentCheckSsoRedirectUri\n        });\n        ifrm.setAttribute(\"src\", src);\n        ifrm.setAttribute(\"title\", \"keycloak-silent-check-sso\");\n        ifrm.style.display = \"none\";\n        document.body.appendChild(ifrm);\n\n        var messageCallback = function (event) {\n          if (event.origin !== window.location.origin || ifrm.contentWindow !== event.source) {\n            return;\n          }\n\n          var oauth = parseCallback(event.data);\n          processCallback(oauth, initPromise);\n          document.body.removeChild(ifrm);\n          window.removeEventListener(\"message\", messageCallback);\n        };\n\n        window.addEventListener(\"message\", messageCallback);\n      };\n\n      var options = {};\n\n      switch (initOptions.onLoad) {\n        case 'check-sso':\n          if (loginIframe.enable) {\n            setupCheckLoginIframe().then(function () {\n              checkLoginIframe().then(function (unchanged) {\n                if (!unchanged) {\n                  kc.silentCheckSsoRedirectUri ? checkSsoSilently() : doLogin(false);\n                } else {\n                  initPromise.setSuccess();\n                }\n              }).catch(function (error) {\n                initPromise.setError(error);\n              });\n            });\n          } else {\n            kc.silentCheckSsoRedirectUri ? checkSsoSilently() : doLogin(false);\n          }\n\n          break;\n\n        case 'login-required':\n          doLogin(true);\n          break;\n\n        default:\n          throw 'Invalid value for onLoad';\n      }\n    }\n\n    function processInit() {\n      var callback = parseCallback(window.location.href);\n\n      if (callback) {\n        window.history.replaceState(window.history.state, null, callback.newUrl);\n      }\n\n      if (callback && callback.valid) {\n        return setupCheckLoginIframe().then(function () {\n          processCallback(callback, initPromise);\n        }).catch(function (error) {\n          initPromise.setError(error);\n        });\n      } else if (initOptions) {\n        if (initOptions.token && initOptions.refreshToken) {\n          setToken(initOptions.token, initOptions.refreshToken, initOptions.idToken);\n\n          if (loginIframe.enable) {\n            setupCheckLoginIframe().then(function () {\n              checkLoginIframe().then(function (unchanged) {\n                if (unchanged) {\n                  kc.onAuthSuccess && kc.onAuthSuccess();\n                  initPromise.setSuccess();\n                  scheduleCheckIframe();\n                } else {\n                  initPromise.setSuccess();\n                }\n              }).catch(function (error) {\n                initPromise.setError(error);\n              });\n            });\n          } else {\n            kc.updateToken(-1).then(function () {\n              kc.onAuthSuccess && kc.onAuthSuccess();\n              initPromise.setSuccess();\n            }).catch(function (error) {\n              kc.onAuthError && kc.onAuthError();\n\n              if (initOptions.onLoad) {\n                onLoad();\n              } else {\n                initPromise.setError(error);\n              }\n            });\n          }\n        } else if (initOptions.onLoad) {\n          onLoad();\n        } else {\n          initPromise.setSuccess();\n        }\n      } else {\n        initPromise.setSuccess();\n      }\n    }\n\n    function domReady() {\n      var promise = createPromise();\n\n      var checkReadyState = function () {\n        if (document.readyState === 'interactive' || document.readyState === 'complete') {\n          document.removeEventListener('readystatechange', checkReadyState);\n          promise.setSuccess();\n        }\n      };\n\n      document.addEventListener('readystatechange', checkReadyState);\n      checkReadyState(); // just in case the event was already fired and we missed it (in case the init is done later than at the load time, i.e. it's done from code)\n\n      return promise.promise;\n    }\n\n    configPromise.then(function () {\n      domReady().then(check3pCookiesSupported).then(processInit).catch(function (error) {\n        promise.setError(error);\n      });\n    });\n    configPromise.catch(function (error) {\n      promise.setError(error);\n    });\n    return promise.promise;\n  };\n\n  kc.login = function (options) {\n    return adapter.login(options);\n  };\n\n  function generateRandomData(len) {\n    // use web crypto APIs if possible\n    var array = null;\n    var crypto = window.crypto || window.msCrypto;\n\n    if (crypto && crypto.getRandomValues && window.Uint8Array) {\n      array = new Uint8Array(len);\n      crypto.getRandomValues(array);\n      return array;\n    } // fallback to Math random\n\n\n    array = new Array(len);\n\n    for (var j = 0; j < array.length; j++) {\n      array[j] = Math.floor(256 * Math.random());\n    }\n\n    return array;\n  }\n\n  function generateCodeVerifier(len) {\n    return generateRandomString(len, 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789');\n  }\n\n  function generateRandomString(len, alphabet) {\n    var randomData = generateRandomData(len);\n    var chars = new Array(len);\n\n    for (var i = 0; i < len; i++) {\n      chars[i] = alphabet.charCodeAt(randomData[i] % alphabet.length);\n    }\n\n    return String.fromCharCode.apply(null, chars);\n  }\n\n  function generatePkceChallenge(pkceMethod, codeVerifier) {\n    switch (pkceMethod) {\n      // The use of the \"plain\" method is considered insecure and therefore not supported.\n      case \"S256\":\n        // hash codeVerifier, then encode as url-safe base64 without padding\n        var hashBytes = new Uint8Array(sha256.arrayBuffer(codeVerifier));\n        var encodedHash = base64.fromByteArray(hashBytes).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/\\=/g, '');\n        return encodedHash;\n\n      default:\n        throw 'Invalid value for pkceMethod';\n    }\n  }\n\n  function buildClaimsParameter(requestedAcr) {\n    var claims = {\n      id_token: {\n        acr: requestedAcr\n      }\n    };\n    return JSON.stringify(claims);\n  }\n\n  kc.createLoginUrl = function (options) {\n    var state = createUUID();\n    var nonce = createUUID();\n    var redirectUri = adapter.redirectUri(options);\n    var callbackState = {\n      state: state,\n      nonce: nonce,\n      redirectUri: encodeURIComponent(redirectUri)\n    };\n\n    if (options && options.prompt) {\n      callbackState.prompt = options.prompt;\n    }\n\n    var baseUrl;\n\n    if (options && options.action == 'register') {\n      baseUrl = kc.endpoints.register();\n    } else {\n      baseUrl = kc.endpoints.authorize();\n    }\n\n    var scope = options && options.scope || kc.scope;\n\n    if (!scope) {\n      // if scope is not set, default to \"openid\"\n      scope = \"openid\";\n    } else if (scope.indexOf(\"openid\") === -1) {\n      // if openid scope is missing, prefix the given scopes with it\n      scope = \"openid \" + scope;\n    }\n\n    var url = baseUrl + '?client_id=' + encodeURIComponent(kc.clientId) + '&redirect_uri=' + encodeURIComponent(redirectUri) + '&state=' + encodeURIComponent(state) + '&response_mode=' + encodeURIComponent(kc.responseMode) + '&response_type=' + encodeURIComponent(kc.responseType) + '&scope=' + encodeURIComponent(scope);\n\n    if (useNonce) {\n      url = url + '&nonce=' + encodeURIComponent(nonce);\n    }\n\n    if (options && options.prompt) {\n      url += '&prompt=' + encodeURIComponent(options.prompt);\n    }\n\n    if (options && options.maxAge) {\n      url += '&max_age=' + encodeURIComponent(options.maxAge);\n    }\n\n    if (options && options.loginHint) {\n      url += '&login_hint=' + encodeURIComponent(options.loginHint);\n    }\n\n    if (options && options.idpHint) {\n      url += '&kc_idp_hint=' + encodeURIComponent(options.idpHint);\n    }\n\n    if (options && options.action && options.action != 'register') {\n      url += '&kc_action=' + encodeURIComponent(options.action);\n    }\n\n    if (options && options.locale) {\n      url += '&ui_locales=' + encodeURIComponent(options.locale);\n    }\n\n    if (options && options.acr) {\n      var claimsParameter = buildClaimsParameter(options.acr);\n      url += '&claims=' + encodeURIComponent(claimsParameter);\n    }\n\n    if (kc.pkceMethod) {\n      var codeVerifier = generateCodeVerifier(96);\n      callbackState.pkceCodeVerifier = codeVerifier;\n      var pkceChallenge = generatePkceChallenge(kc.pkceMethod, codeVerifier);\n      url += '&code_challenge=' + pkceChallenge;\n      url += '&code_challenge_method=' + kc.pkceMethod;\n    }\n\n    callbackStorage.add(callbackState);\n    return url;\n  };\n\n  kc.logout = function (options) {\n    return adapter.logout(options);\n  };\n\n  kc.createLogoutUrl = function (options) {\n    var url = kc.endpoints.logout() + '?client_id=' + encodeURIComponent(kc.clientId) + '&post_logout_redirect_uri=' + encodeURIComponent(adapter.redirectUri(options, false));\n\n    if (kc.idToken) {\n      url += '&id_token_hint=' + encodeURIComponent(kc.idToken);\n    }\n\n    return url;\n  };\n\n  kc.register = function (options) {\n    return adapter.register(options);\n  };\n\n  kc.createRegisterUrl = function (options) {\n    if (!options) {\n      options = {};\n    }\n\n    options.action = 'register';\n    return kc.createLoginUrl(options);\n  };\n\n  kc.createAccountUrl = function (options) {\n    var realm = getRealmUrl();\n    var url = undefined;\n\n    if (typeof realm !== 'undefined') {\n      url = realm + '/account' + '?referrer=' + encodeURIComponent(kc.clientId) + '&referrer_uri=' + encodeURIComponent(adapter.redirectUri(options));\n    }\n\n    return url;\n  };\n\n  kc.accountManagement = function () {\n    return adapter.accountManagement();\n  };\n\n  kc.hasRealmRole = function (role) {\n    var access = kc.realmAccess;\n    return !!access && access.roles.indexOf(role) >= 0;\n  };\n\n  kc.hasResourceRole = function (role, resource) {\n    if (!kc.resourceAccess) {\n      return false;\n    }\n\n    var access = kc.resourceAccess[resource || kc.clientId];\n    return !!access && access.roles.indexOf(role) >= 0;\n  };\n\n  kc.loadUserProfile = function () {\n    var url = getRealmUrl() + '/account';\n    var req = new XMLHttpRequest();\n    req.open('GET', url, true);\n    req.setRequestHeader('Accept', 'application/json');\n    req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n    var promise = createPromise();\n\n    req.onreadystatechange = function () {\n      if (req.readyState == 4) {\n        if (req.status == 200) {\n          kc.profile = JSON.parse(req.responseText);\n          promise.setSuccess(kc.profile);\n        } else {\n          promise.setError();\n        }\n      }\n    };\n\n    req.send();\n    return promise.promise;\n  };\n\n  kc.loadUserInfo = function () {\n    var url = kc.endpoints.userinfo();\n    var req = new XMLHttpRequest();\n    req.open('GET', url, true);\n    req.setRequestHeader('Accept', 'application/json');\n    req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n    var promise = createPromise();\n\n    req.onreadystatechange = function () {\n      if (req.readyState == 4) {\n        if (req.status == 200) {\n          kc.userInfo = JSON.parse(req.responseText);\n          promise.setSuccess(kc.userInfo);\n        } else {\n          promise.setError();\n        }\n      }\n    };\n\n    req.send();\n    return promise.promise;\n  };\n\n  kc.isTokenExpired = function (minValidity) {\n    if (!kc.tokenParsed || !kc.refreshToken && kc.flow != 'implicit') {\n      throw 'Not authenticated';\n    }\n\n    if (kc.timeSkew == null) {\n      logInfo('[KEYCLOAK] Unable to determine if token is expired as timeskew is not set');\n      return true;\n    }\n\n    var expiresIn = kc.tokenParsed['exp'] - Math.ceil(new Date().getTime() / 1000) + kc.timeSkew;\n\n    if (minValidity) {\n      if (isNaN(minValidity)) {\n        throw 'Invalid minValidity';\n      }\n\n      expiresIn -= minValidity;\n    }\n\n    return expiresIn < 0;\n  };\n\n  kc.updateToken = function (minValidity) {\n    var promise = createPromise();\n\n    if (!kc.refreshToken) {\n      promise.setError();\n      return promise.promise;\n    }\n\n    minValidity = minValidity || 5;\n\n    var exec = function () {\n      var refreshToken = false;\n\n      if (minValidity == -1) {\n        refreshToken = true;\n        logInfo('[KEYCLOAK] Refreshing token: forced refresh');\n      } else if (!kc.tokenParsed || kc.isTokenExpired(minValidity)) {\n        refreshToken = true;\n        logInfo('[KEYCLOAK] Refreshing token: token expired');\n      }\n\n      if (!refreshToken) {\n        promise.setSuccess(false);\n      } else {\n        var params = 'grant_type=refresh_token&' + 'refresh_token=' + kc.refreshToken;\n        var url = kc.endpoints.token();\n        refreshQueue.push(promise);\n\n        if (refreshQueue.length == 1) {\n          var req = new XMLHttpRequest();\n          req.open('POST', url, true);\n          req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n          req.withCredentials = true;\n          params += '&client_id=' + encodeURIComponent(kc.clientId);\n          var timeLocal = new Date().getTime();\n\n          req.onreadystatechange = function () {\n            if (req.readyState == 4) {\n              if (req.status == 200) {\n                logInfo('[KEYCLOAK] Token refreshed');\n                timeLocal = (timeLocal + new Date().getTime()) / 2;\n                var tokenResponse = JSON.parse(req.responseText);\n                setToken(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], timeLocal);\n                kc.onAuthRefreshSuccess && kc.onAuthRefreshSuccess();\n\n                for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                  p.setSuccess(true);\n                }\n              } else {\n                logWarn('[KEYCLOAK] Failed to refresh token');\n\n                if (req.status == 400) {\n                  kc.clearToken();\n                }\n\n                kc.onAuthRefreshError && kc.onAuthRefreshError();\n\n                for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                  p.setError(true);\n                }\n              }\n            }\n          };\n\n          req.send(params);\n        }\n      }\n    };\n\n    if (loginIframe.enable) {\n      var iframePromise = checkLoginIframe();\n      iframePromise.then(function () {\n        exec();\n      }).catch(function (error) {\n        promise.setError(error);\n      });\n    } else {\n      exec();\n    }\n\n    return promise.promise;\n  };\n\n  kc.clearToken = function () {\n    if (kc.token) {\n      setToken(null, null, null);\n      kc.onAuthLogout && kc.onAuthLogout();\n\n      if (kc.loginRequired) {\n        kc.login();\n      }\n    }\n  };\n\n  function getRealmUrl() {\n    if (typeof kc.authServerUrl !== 'undefined') {\n      if (kc.authServerUrl.charAt(kc.authServerUrl.length - 1) == '/') {\n        return kc.authServerUrl + 'realms/' + encodeURIComponent(kc.realm);\n      } else {\n        return kc.authServerUrl + '/realms/' + encodeURIComponent(kc.realm);\n      }\n    } else {\n      return undefined;\n    }\n  }\n\n  function getOrigin() {\n    if (!window.location.origin) {\n      return window.location.protocol + \"//\" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n    } else {\n      return window.location.origin;\n    }\n  }\n\n  function processCallback(oauth, promise) {\n    var code = oauth.code;\n    var error = oauth.error;\n    var prompt = oauth.prompt;\n    var timeLocal = new Date().getTime();\n\n    if (oauth['kc_action_status']) {\n      kc.onActionUpdate && kc.onActionUpdate(oauth['kc_action_status']);\n    }\n\n    if (error) {\n      if (prompt != 'none') {\n        var errorData = {\n          error: error,\n          error_description: oauth.error_description\n        };\n        kc.onAuthError && kc.onAuthError(errorData);\n        promise && promise.setError(errorData);\n      } else {\n        promise && promise.setSuccess();\n      }\n\n      return;\n    } else if (kc.flow != 'standard' && (oauth.access_token || oauth.id_token)) {\n      authSuccess(oauth.access_token, null, oauth.id_token, true);\n    }\n\n    if (kc.flow != 'implicit' && code) {\n      var params = 'code=' + code + '&grant_type=authorization_code';\n      var url = kc.endpoints.token();\n      var req = new XMLHttpRequest();\n      req.open('POST', url, true);\n      req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n      params += '&client_id=' + encodeURIComponent(kc.clientId);\n      params += '&redirect_uri=' + oauth.redirectUri;\n\n      if (oauth.pkceCodeVerifier) {\n        params += '&code_verifier=' + oauth.pkceCodeVerifier;\n      }\n\n      req.withCredentials = true;\n\n      req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n          if (req.status == 200) {\n            var tokenResponse = JSON.parse(req.responseText);\n            authSuccess(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], kc.flow === 'standard');\n            scheduleCheckIframe();\n          } else {\n            kc.onAuthError && kc.onAuthError();\n            promise && promise.setError();\n          }\n        }\n      };\n\n      req.send(params);\n    }\n\n    function authSuccess(accessToken, refreshToken, idToken, fulfillPromise) {\n      timeLocal = (timeLocal + new Date().getTime()) / 2;\n      setToken(accessToken, refreshToken, idToken, timeLocal);\n\n      if (useNonce && (kc.tokenParsed && kc.tokenParsed.nonce != oauth.storedNonce || kc.refreshTokenParsed && kc.refreshTokenParsed.nonce != oauth.storedNonce || kc.idTokenParsed && kc.idTokenParsed.nonce != oauth.storedNonce)) {\n        logInfo('[KEYCLOAK] Invalid nonce, clearing token');\n        kc.clearToken();\n        promise && promise.setError();\n      } else {\n        if (fulfillPromise) {\n          kc.onAuthSuccess && kc.onAuthSuccess();\n          promise && promise.setSuccess();\n        }\n      }\n    }\n  }\n\n  function loadConfig(url) {\n    var promise = createPromise();\n    var configUrl;\n\n    if (!config) {\n      configUrl = 'keycloak.json';\n    } else if (typeof config === 'string') {\n      configUrl = config;\n    }\n\n    function setupOidcEndoints(oidcConfiguration) {\n      if (!oidcConfiguration) {\n        kc.endpoints = {\n          authorize: function () {\n            return getRealmUrl() + '/protocol/openid-connect/auth';\n          },\n          token: function () {\n            return getRealmUrl() + '/protocol/openid-connect/token';\n          },\n          logout: function () {\n            return getRealmUrl() + '/protocol/openid-connect/logout';\n          },\n          checkSessionIframe: function () {\n            var src = getRealmUrl() + '/protocol/openid-connect/login-status-iframe.html';\n\n            if (kc.iframeVersion) {\n              src = src + '?version=' + kc.iframeVersion;\n            }\n\n            return src;\n          },\n          thirdPartyCookiesIframe: function () {\n            var src = getRealmUrl() + '/protocol/openid-connect/3p-cookies/step1.html';\n\n            if (kc.iframeVersion) {\n              src = src + '?version=' + kc.iframeVersion;\n            }\n\n            return src;\n          },\n          register: function () {\n            return getRealmUrl() + '/protocol/openid-connect/registrations';\n          },\n          userinfo: function () {\n            return getRealmUrl() + '/protocol/openid-connect/userinfo';\n          }\n        };\n      } else {\n        kc.endpoints = {\n          authorize: function () {\n            return oidcConfiguration.authorization_endpoint;\n          },\n          token: function () {\n            return oidcConfiguration.token_endpoint;\n          },\n          logout: function () {\n            if (!oidcConfiguration.end_session_endpoint) {\n              throw \"Not supported by the OIDC server\";\n            }\n\n            return oidcConfiguration.end_session_endpoint;\n          },\n          checkSessionIframe: function () {\n            if (!oidcConfiguration.check_session_iframe) {\n              throw \"Not supported by the OIDC server\";\n            }\n\n            return oidcConfiguration.check_session_iframe;\n          },\n          register: function () {\n            throw 'Redirection to \"Register user\" page not supported in standard OIDC mode';\n          },\n          userinfo: function () {\n            if (!oidcConfiguration.userinfo_endpoint) {\n              throw \"Not supported by the OIDC server\";\n            }\n\n            return oidcConfiguration.userinfo_endpoint;\n          }\n        };\n      }\n    }\n\n    if (configUrl) {\n      var req = new XMLHttpRequest();\n      req.open('GET', configUrl, true);\n      req.setRequestHeader('Accept', 'application/json');\n\n      req.onreadystatechange = function () {\n        if (req.readyState == 4) {\n          if (req.status == 200 || fileLoaded(req)) {\n            var config = JSON.parse(req.responseText);\n            kc.authServerUrl = config['auth-server-url'];\n            kc.realm = config['realm'];\n            kc.clientId = config['resource'];\n            setupOidcEndoints(null);\n            promise.setSuccess();\n          } else {\n            promise.setError();\n          }\n        }\n      };\n\n      req.send();\n    } else {\n      if (!config.clientId) {\n        throw 'clientId missing';\n      }\n\n      kc.clientId = config.clientId;\n      var oidcProvider = config['oidcProvider'];\n\n      if (!oidcProvider) {\n        if (!config['url']) {\n          var scripts = document.getElementsByTagName('script');\n\n          for (var i = 0; i < scripts.length; i++) {\n            if (scripts[i].src.match(/.*keycloak\\.js/)) {\n              config.url = scripts[i].src.substr(0, scripts[i].src.indexOf('/js/keycloak.js'));\n              break;\n            }\n          }\n        }\n\n        if (!config.realm) {\n          throw 'realm missing';\n        }\n\n        kc.authServerUrl = config.url;\n        kc.realm = config.realm;\n        setupOidcEndoints(null);\n        promise.setSuccess();\n      } else {\n        if (typeof oidcProvider === 'string') {\n          var oidcProviderConfigUrl;\n\n          if (oidcProvider.charAt(oidcProvider.length - 1) == '/') {\n            oidcProviderConfigUrl = oidcProvider + '.well-known/openid-configuration';\n          } else {\n            oidcProviderConfigUrl = oidcProvider + '/.well-known/openid-configuration';\n          }\n\n          var req = new XMLHttpRequest();\n          req.open('GET', oidcProviderConfigUrl, true);\n          req.setRequestHeader('Accept', 'application/json');\n\n          req.onreadystatechange = function () {\n            if (req.readyState == 4) {\n              if (req.status == 200 || fileLoaded(req)) {\n                var oidcProviderConfig = JSON.parse(req.responseText);\n                setupOidcEndoints(oidcProviderConfig);\n                promise.setSuccess();\n              } else {\n                promise.setError();\n              }\n            }\n          };\n\n          req.send();\n        } else {\n          setupOidcEndoints(oidcProvider);\n          promise.setSuccess();\n        }\n      }\n    }\n\n    return promise.promise;\n  }\n\n  function fileLoaded(xhr) {\n    return xhr.status == 0 && xhr.responseText && xhr.responseURL.startsWith('file:');\n  }\n\n  function setToken(token, refreshToken, idToken, timeLocal) {\n    if (kc.tokenTimeoutHandle) {\n      clearTimeout(kc.tokenTimeoutHandle);\n      kc.tokenTimeoutHandle = null;\n    }\n\n    if (refreshToken) {\n      kc.refreshToken = refreshToken;\n      kc.refreshTokenParsed = decodeToken(refreshToken);\n    } else {\n      delete kc.refreshToken;\n      delete kc.refreshTokenParsed;\n    }\n\n    if (idToken) {\n      kc.idToken = idToken;\n      kc.idTokenParsed = decodeToken(idToken);\n    } else {\n      delete kc.idToken;\n      delete kc.idTokenParsed;\n    }\n\n    if (token) {\n      kc.token = token;\n      kc.tokenParsed = decodeToken(token);\n      kc.sessionId = kc.tokenParsed.session_state;\n      kc.authenticated = true;\n      kc.subject = kc.tokenParsed.sub;\n      kc.realmAccess = kc.tokenParsed.realm_access;\n      kc.resourceAccess = kc.tokenParsed.resource_access;\n\n      if (timeLocal) {\n        kc.timeSkew = Math.floor(timeLocal / 1000) - kc.tokenParsed.iat;\n      }\n\n      if (kc.timeSkew != null) {\n        logInfo('[KEYCLOAK] Estimated time difference between browser and server is ' + kc.timeSkew + ' seconds');\n\n        if (kc.onTokenExpired) {\n          var expiresIn = (kc.tokenParsed['exp'] - new Date().getTime() / 1000 + kc.timeSkew) * 1000;\n          logInfo('[KEYCLOAK] Token expires in ' + Math.round(expiresIn / 1000) + ' s');\n\n          if (expiresIn <= 0) {\n            kc.onTokenExpired();\n          } else {\n            kc.tokenTimeoutHandle = setTimeout(kc.onTokenExpired, expiresIn);\n          }\n        }\n      }\n    } else {\n      delete kc.token;\n      delete kc.tokenParsed;\n      delete kc.subject;\n      delete kc.realmAccess;\n      delete kc.resourceAccess;\n      kc.authenticated = false;\n    }\n  }\n\n  function decodeToken(str) {\n    str = str.split('.')[1];\n    str = str.replace(/-/g, '+');\n    str = str.replace(/_/g, '/');\n\n    switch (str.length % 4) {\n      case 0:\n        break;\n\n      case 2:\n        str += '==';\n        break;\n\n      case 3:\n        str += '=';\n        break;\n\n      default:\n        throw 'Invalid token';\n    }\n\n    str = decodeURIComponent(escape(atob(str)));\n    str = JSON.parse(str);\n    return str;\n  }\n\n  function createUUID() {\n    var hexDigits = '0123456789abcdef';\n    var s = generateRandomString(36, hexDigits).split(\"\");\n    s[14] = '4';\n    s[19] = hexDigits.substr(s[19] & 0x3 | 0x8, 1);\n    s[8] = s[13] = s[18] = s[23] = '-';\n    var uuid = s.join('');\n    return uuid;\n  }\n\n  function parseCallback(url) {\n    var oauth = parseCallbackUrl(url);\n\n    if (!oauth) {\n      return;\n    }\n\n    var oauthState = callbackStorage.get(oauth.state);\n\n    if (oauthState) {\n      oauth.valid = true;\n      oauth.redirectUri = oauthState.redirectUri;\n      oauth.storedNonce = oauthState.nonce;\n      oauth.prompt = oauthState.prompt;\n      oauth.pkceCodeVerifier = oauthState.pkceCodeVerifier;\n    }\n\n    return oauth;\n  }\n\n  function parseCallbackUrl(url) {\n    var supportedParams;\n\n    switch (kc.flow) {\n      case 'standard':\n        supportedParams = ['code', 'state', 'session_state', 'kc_action_status'];\n        break;\n\n      case 'implicit':\n        supportedParams = ['access_token', 'token_type', 'id_token', 'state', 'session_state', 'expires_in', 'kc_action_status'];\n        break;\n\n      case 'hybrid':\n        supportedParams = ['access_token', 'token_type', 'id_token', 'code', 'state', 'session_state', 'expires_in', 'kc_action_status'];\n        break;\n    }\n\n    supportedParams.push('error');\n    supportedParams.push('error_description');\n    supportedParams.push('error_uri');\n    var queryIndex = url.indexOf('?');\n    var fragmentIndex = url.indexOf('#');\n    var newUrl;\n    var parsed;\n\n    if (kc.responseMode === 'query' && queryIndex !== -1) {\n      newUrl = url.substring(0, queryIndex);\n      parsed = parseCallbackParams(url.substring(queryIndex + 1, fragmentIndex !== -1 ? fragmentIndex : url.length), supportedParams);\n\n      if (parsed.paramsString !== '') {\n        newUrl += '?' + parsed.paramsString;\n      }\n\n      if (fragmentIndex !== -1) {\n        newUrl += url.substring(fragmentIndex);\n      }\n    } else if (kc.responseMode === 'fragment' && fragmentIndex !== -1) {\n      newUrl = url.substring(0, fragmentIndex);\n      parsed = parseCallbackParams(url.substring(fragmentIndex + 1), supportedParams);\n\n      if (parsed.paramsString !== '') {\n        newUrl += '#' + parsed.paramsString;\n      }\n    }\n\n    if (parsed && parsed.oauthParams) {\n      if (kc.flow === 'standard' || kc.flow === 'hybrid') {\n        if ((parsed.oauthParams.code || parsed.oauthParams.error) && parsed.oauthParams.state) {\n          parsed.oauthParams.newUrl = newUrl;\n          return parsed.oauthParams;\n        }\n      } else if (kc.flow === 'implicit') {\n        if ((parsed.oauthParams.access_token || parsed.oauthParams.error) && parsed.oauthParams.state) {\n          parsed.oauthParams.newUrl = newUrl;\n          return parsed.oauthParams;\n        }\n      }\n    }\n  }\n\n  function parseCallbackParams(paramsString, supportedParams) {\n    var p = paramsString.split('&');\n    var result = {\n      paramsString: '',\n      oauthParams: {}\n    };\n\n    for (var i = 0; i < p.length; i++) {\n      var split = p[i].indexOf(\"=\");\n      var key = p[i].slice(0, split);\n\n      if (supportedParams.indexOf(key) !== -1) {\n        result.oauthParams[key] = p[i].slice(split + 1);\n      } else {\n        if (result.paramsString !== '') {\n          result.paramsString += '&';\n        }\n\n        result.paramsString += p[i];\n      }\n    }\n\n    return result;\n  }\n\n  function createPromise() {\n    // Need to create a native Promise which also preserves the\n    // interface of the custom promise type previously used by the API\n    var p = {\n      setSuccess: function (result) {\n        p.resolve(result);\n      },\n      setError: function (result) {\n        p.reject(result);\n      }\n    };\n    p.promise = new Promise(function (resolve, reject) {\n      p.resolve = resolve;\n      p.reject = reject;\n    });\n\n    p.promise.success = function (callback) {\n      logPromiseDeprecation();\n      this.then(function handleSuccess(value) {\n        callback(value);\n      });\n      return this;\n    };\n\n    p.promise.error = function (callback) {\n      logPromiseDeprecation();\n      this.catch(function handleError(error) {\n        callback(error);\n      });\n      return this;\n    };\n\n    return p;\n  } // Function to extend existing native Promise with timeout\n\n\n  function applyTimeoutToPromise(promise, timeout, errorMessage) {\n    var timeoutHandle = null;\n    var timeoutPromise = new Promise(function (resolve, reject) {\n      timeoutHandle = setTimeout(function () {\n        reject({\n          \"error\": errorMessage || \"Promise is not settled within timeout of \" + timeout + \"ms\"\n        });\n      }, timeout);\n    });\n    return Promise.race([promise, timeoutPromise]).finally(function () {\n      clearTimeout(timeoutHandle);\n    });\n  }\n\n  function setupCheckLoginIframe() {\n    var promise = createPromise();\n\n    if (!loginIframe.enable) {\n      promise.setSuccess();\n      return promise.promise;\n    }\n\n    if (loginIframe.iframe) {\n      promise.setSuccess();\n      return promise.promise;\n    }\n\n    var iframe = document.createElement('iframe');\n    loginIframe.iframe = iframe;\n\n    iframe.onload = function () {\n      var authUrl = kc.endpoints.authorize();\n\n      if (authUrl.charAt(0) === '/') {\n        loginIframe.iframeOrigin = getOrigin();\n      } else {\n        loginIframe.iframeOrigin = authUrl.substring(0, authUrl.indexOf('/', 8));\n      }\n\n      promise.setSuccess();\n    };\n\n    var src = kc.endpoints.checkSessionIframe();\n    iframe.setAttribute('src', src);\n    iframe.setAttribute('title', 'keycloak-session-iframe');\n    iframe.style.display = 'none';\n    document.body.appendChild(iframe);\n\n    var messageCallback = function (event) {\n      if (event.origin !== loginIframe.iframeOrigin || loginIframe.iframe.contentWindow !== event.source) {\n        return;\n      }\n\n      if (!(event.data == 'unchanged' || event.data == 'changed' || event.data == 'error')) {\n        return;\n      }\n\n      if (event.data != 'unchanged') {\n        kc.clearToken();\n      }\n\n      var callbacks = loginIframe.callbackList.splice(0, loginIframe.callbackList.length);\n\n      for (var i = callbacks.length - 1; i >= 0; --i) {\n        var promise = callbacks[i];\n\n        if (event.data == 'error') {\n          promise.setError();\n        } else {\n          promise.setSuccess(event.data == 'unchanged');\n        }\n      }\n    };\n\n    window.addEventListener('message', messageCallback, false);\n    return promise.promise;\n  }\n\n  function scheduleCheckIframe() {\n    if (loginIframe.enable) {\n      if (kc.token) {\n        setTimeout(function () {\n          checkLoginIframe().then(function (unchanged) {\n            if (unchanged) {\n              scheduleCheckIframe();\n            }\n          });\n        }, loginIframe.interval * 1000);\n      }\n    }\n  }\n\n  function checkLoginIframe() {\n    var promise = createPromise();\n\n    if (loginIframe.iframe && loginIframe.iframeOrigin) {\n      var msg = kc.clientId + ' ' + (kc.sessionId ? kc.sessionId : '');\n      loginIframe.callbackList.push(promise);\n      var origin = loginIframe.iframeOrigin;\n\n      if (loginIframe.callbackList.length == 1) {\n        loginIframe.iframe.contentWindow.postMessage(msg, origin);\n      }\n    } else {\n      promise.setSuccess();\n    }\n\n    return promise.promise;\n  }\n\n  function check3pCookiesSupported() {\n    var promise = createPromise();\n\n    if (loginIframe.enable || kc.silentCheckSsoRedirectUri) {\n      var iframe = document.createElement('iframe');\n      iframe.setAttribute('src', kc.endpoints.thirdPartyCookiesIframe());\n      iframe.setAttribute('title', 'keycloak-3p-check-iframe');\n      iframe.style.display = 'none';\n      document.body.appendChild(iframe);\n\n      var messageCallback = function (event) {\n        if (iframe.contentWindow !== event.source) {\n          return;\n        }\n\n        if (event.data !== \"supported\" && event.data !== \"unsupported\") {\n          return;\n        } else if (event.data === \"unsupported\") {\n          loginIframe.enable = false;\n\n          if (kc.silentCheckSsoFallback) {\n            kc.silentCheckSsoRedirectUri = false;\n          }\n\n          logWarn(\"[KEYCLOAK] 3rd party cookies aren't supported by this browser. checkLoginIframe and \" + \"silent check-sso are not available.\");\n        }\n\n        document.body.removeChild(iframe);\n        window.removeEventListener(\"message\", messageCallback);\n        promise.setSuccess();\n      };\n\n      window.addEventListener('message', messageCallback, false);\n    } else {\n      promise.setSuccess();\n    }\n\n    return applyTimeoutToPromise(promise.promise, kc.messageReceiveTimeout, \"Timeout when waiting for 3rd party check iframe message.\");\n  }\n\n  function loadAdapter(type) {\n    if (!type || type == 'default') {\n      return {\n        login: function (options) {\n          window.location.assign(kc.createLoginUrl(options));\n          return createPromise().promise;\n        },\n        logout: function (options) {\n          window.location.replace(kc.createLogoutUrl(options));\n          return createPromise().promise;\n        },\n        register: function (options) {\n          window.location.assign(kc.createRegisterUrl(options));\n          return createPromise().promise;\n        },\n        accountManagement: function () {\n          var accountUrl = kc.createAccountUrl();\n\n          if (typeof accountUrl !== 'undefined') {\n            window.location.href = accountUrl;\n          } else {\n            throw \"Not supported by the OIDC server\";\n          }\n\n          return createPromise().promise;\n        },\n        redirectUri: function (options, encodeHash) {\n          if (options && options.redirectUri) {\n            return options.redirectUri;\n          } else if (kc.redirectUri) {\n            return kc.redirectUri;\n          } else {\n            return location.href;\n          }\n        }\n      };\n    }\n\n    if (type == 'cordova') {\n      loginIframe.enable = false;\n\n      var cordovaOpenWindowWrapper = function (loginUrl, target, options) {\n        if (window.cordova && window.cordova.InAppBrowser) {\n          // Use inappbrowser for IOS and Android if available\n          return window.cordova.InAppBrowser.open(loginUrl, target, options);\n        } else {\n          return window.open(loginUrl, target, options);\n        }\n      };\n\n      var shallowCloneCordovaOptions = function (userOptions) {\n        if (userOptions && userOptions.cordovaOptions) {\n          return Object.keys(userOptions.cordovaOptions).reduce(function (options, optionName) {\n            options[optionName] = userOptions.cordovaOptions[optionName];\n            return options;\n          }, {});\n        } else {\n          return {};\n        }\n      };\n\n      var formatCordovaOptions = function (cordovaOptions) {\n        return Object.keys(cordovaOptions).reduce(function (options, optionName) {\n          options.push(optionName + \"=\" + cordovaOptions[optionName]);\n          return options;\n        }, []).join(\",\");\n      };\n\n      var createCordovaOptions = function (userOptions) {\n        var cordovaOptions = shallowCloneCordovaOptions(userOptions);\n        cordovaOptions.location = 'no';\n\n        if (userOptions && userOptions.prompt == 'none') {\n          cordovaOptions.hidden = 'yes';\n        }\n\n        return formatCordovaOptions(cordovaOptions);\n      };\n\n      var cordovaRedirectUri = kc.redirectUri || 'http://localhost';\n      return {\n        login: function (options) {\n          var promise = createPromise();\n          var cordovaOptions = createCordovaOptions(options);\n          var loginUrl = kc.createLoginUrl(options);\n          var ref = cordovaOpenWindowWrapper(loginUrl, '_blank', cordovaOptions);\n          var completed = false;\n          var closed = false;\n\n          var closeBrowser = function () {\n            closed = true;\n            ref.close();\n          };\n\n          ref.addEventListener('loadstart', function (event) {\n            if (event.url.indexOf(cordovaRedirectUri) == 0) {\n              var callback = parseCallback(event.url);\n              processCallback(callback, promise);\n              closeBrowser();\n              completed = true;\n            }\n          });\n          ref.addEventListener('loaderror', function (event) {\n            if (!completed) {\n              if (event.url.indexOf(cordovaRedirectUri) == 0) {\n                var callback = parseCallback(event.url);\n                processCallback(callback, promise);\n                closeBrowser();\n                completed = true;\n              } else {\n                promise.setError();\n                closeBrowser();\n              }\n            }\n          });\n          ref.addEventListener('exit', function (event) {\n            if (!closed) {\n              promise.setError({\n                reason: \"closed_by_user\"\n              });\n            }\n          });\n          return promise.promise;\n        },\n        logout: function (options) {\n          var promise = createPromise();\n          var logoutUrl = kc.createLogoutUrl(options);\n          var ref = cordovaOpenWindowWrapper(logoutUrl, '_blank', 'location=no,hidden=yes,clearcache=yes');\n          var error;\n          ref.addEventListener('loadstart', function (event) {\n            if (event.url.indexOf(cordovaRedirectUri) == 0) {\n              ref.close();\n            }\n          });\n          ref.addEventListener('loaderror', function (event) {\n            if (event.url.indexOf(cordovaRedirectUri) == 0) {\n              ref.close();\n            } else {\n              error = true;\n              ref.close();\n            }\n          });\n          ref.addEventListener('exit', function (event) {\n            if (error) {\n              promise.setError();\n            } else {\n              kc.clearToken();\n              promise.setSuccess();\n            }\n          });\n          return promise.promise;\n        },\n        register: function (options) {\n          var promise = createPromise();\n          var registerUrl = kc.createRegisterUrl();\n          var cordovaOptions = createCordovaOptions(options);\n          var ref = cordovaOpenWindowWrapper(registerUrl, '_blank', cordovaOptions);\n          ref.addEventListener('loadstart', function (event) {\n            if (event.url.indexOf(cordovaRedirectUri) == 0) {\n              ref.close();\n              var oauth = parseCallback(event.url);\n              processCallback(oauth, promise);\n            }\n          });\n          return promise.promise;\n        },\n        accountManagement: function () {\n          var accountUrl = kc.createAccountUrl();\n\n          if (typeof accountUrl !== 'undefined') {\n            var ref = cordovaOpenWindowWrapper(accountUrl, '_blank', 'location=no');\n            ref.addEventListener('loadstart', function (event) {\n              if (event.url.indexOf(cordovaRedirectUri) == 0) {\n                ref.close();\n              }\n            });\n          } else {\n            throw \"Not supported by the OIDC server\";\n          }\n        },\n        redirectUri: function (options) {\n          return cordovaRedirectUri;\n        }\n      };\n    }\n\n    if (type == 'cordova-native') {\n      loginIframe.enable = false;\n      return {\n        login: function (options) {\n          var promise = createPromise();\n          var loginUrl = kc.createLoginUrl(options);\n          universalLinks.subscribe('keycloak', function (event) {\n            universalLinks.unsubscribe('keycloak');\n            window.cordova.plugins.browsertab.close();\n            var oauth = parseCallback(event.url);\n            processCallback(oauth, promise);\n          });\n          window.cordova.plugins.browsertab.openUrl(loginUrl);\n          return promise.promise;\n        },\n        logout: function (options) {\n          var promise = createPromise();\n          var logoutUrl = kc.createLogoutUrl(options);\n          universalLinks.subscribe('keycloak', function (event) {\n            universalLinks.unsubscribe('keycloak');\n            window.cordova.plugins.browsertab.close();\n            kc.clearToken();\n            promise.setSuccess();\n          });\n          window.cordova.plugins.browsertab.openUrl(logoutUrl);\n          return promise.promise;\n        },\n        register: function (options) {\n          var promise = createPromise();\n          var registerUrl = kc.createRegisterUrl(options);\n          universalLinks.subscribe('keycloak', function (event) {\n            universalLinks.unsubscribe('keycloak');\n            window.cordova.plugins.browsertab.close();\n            var oauth = parseCallback(event.url);\n            processCallback(oauth, promise);\n          });\n          window.cordova.plugins.browsertab.openUrl(registerUrl);\n          return promise.promise;\n        },\n        accountManagement: function () {\n          var accountUrl = kc.createAccountUrl();\n\n          if (typeof accountUrl !== 'undefined') {\n            window.cordova.plugins.browsertab.openUrl(accountUrl);\n          } else {\n            throw \"Not supported by the OIDC server\";\n          }\n        },\n        redirectUri: function (options) {\n          if (options && options.redirectUri) {\n            return options.redirectUri;\n          } else if (kc.redirectUri) {\n            return kc.redirectUri;\n          } else {\n            return \"http://localhost\";\n          }\n        }\n      };\n    }\n\n    throw 'invalid adapter type: ' + type;\n  }\n\n  var LocalStorage = function () {\n    if (!(this instanceof LocalStorage)) {\n      return new LocalStorage();\n    }\n\n    localStorage.setItem('kc-test', 'test');\n    localStorage.removeItem('kc-test');\n    var cs = this;\n\n    function clearExpired() {\n      var time = new Date().getTime();\n\n      for (var i = 0; i < localStorage.length; i++) {\n        var key = localStorage.key(i);\n\n        if (key && key.indexOf('kc-callback-') == 0) {\n          var value = localStorage.getItem(key);\n\n          if (value) {\n            try {\n              var expires = JSON.parse(value).expires;\n\n              if (!expires || expires < time) {\n                localStorage.removeItem(key);\n              }\n            } catch (err) {\n              localStorage.removeItem(key);\n            }\n          }\n        }\n      }\n    }\n\n    cs.get = function (state) {\n      if (!state) {\n        return;\n      }\n\n      var key = 'kc-callback-' + state;\n      var value = localStorage.getItem(key);\n\n      if (value) {\n        localStorage.removeItem(key);\n        value = JSON.parse(value);\n      }\n\n      clearExpired();\n      return value;\n    };\n\n    cs.add = function (state) {\n      clearExpired();\n      var key = 'kc-callback-' + state.state;\n      state.expires = new Date().getTime() + 60 * 60 * 1000;\n      localStorage.setItem(key, JSON.stringify(state));\n    };\n  };\n\n  var CookieStorage = function () {\n    if (!(this instanceof CookieStorage)) {\n      return new CookieStorage();\n    }\n\n    var cs = this;\n\n    cs.get = function (state) {\n      if (!state) {\n        return;\n      }\n\n      var value = getCookie('kc-callback-' + state);\n      setCookie('kc-callback-' + state, '', cookieExpiration(-100));\n\n      if (value) {\n        return JSON.parse(value);\n      }\n    };\n\n    cs.add = function (state) {\n      setCookie('kc-callback-' + state.state, JSON.stringify(state), cookieExpiration(60));\n    };\n\n    cs.removeItem = function (key) {\n      setCookie(key, '', cookieExpiration(-100));\n    };\n\n    var cookieExpiration = function (minutes) {\n      var exp = new Date();\n      exp.setTime(exp.getTime() + minutes * 60 * 1000);\n      return exp;\n    };\n\n    var getCookie = function (key) {\n      var name = key + '=';\n      var ca = document.cookie.split(';');\n\n      for (var i = 0; i < ca.length; i++) {\n        var c = ca[i];\n\n        while (c.charAt(0) == ' ') {\n          c = c.substring(1);\n        }\n\n        if (c.indexOf(name) == 0) {\n          return c.substring(name.length, c.length);\n        }\n      }\n\n      return '';\n    };\n\n    var setCookie = function (key, value, expirationDate) {\n      var cookie = key + '=' + value + '; ' + 'expires=' + expirationDate.toUTCString() + '; ';\n      document.cookie = cookie;\n    };\n  };\n\n  function createCallbackStorage() {\n    try {\n      return new LocalStorage();\n    } catch (err) {}\n\n    return new CookieStorage();\n  }\n\n  function createLogger(fn) {\n    return function () {\n      if (kc.enableLogging) {\n        fn.apply(console, Array.prototype.slice.call(arguments));\n      }\n    };\n  }\n}\n\nexport { Keycloak as default };","map":{"version":3,"sources":["/srv/http/capnews/gallery-frontend/node_modules/keycloak-js/dist/keycloak.mjs"],"names":["base64","sha256","Promise","Error","loggedConstructorDeprecation","logConstructorDeprecation","console","warn","loggedPromiseDeprecation","logPromiseDeprecation","Keycloak","config","kc","adapter","refreshQueue","callbackStorage","loginIframe","enable","callbackList","interval","scripts","document","getElementsByTagName","i","length","src","indexOf","iframeVersion","substring","split","useNonce","logInfo","createLogger","info","logWarn","init","initOptions","authenticated","createCallbackStorage","adapters","loadAdapter","window","Cordova","cordova","checkLoginIframe","checkLoginIframeInterval","onLoad","loginRequired","responseMode","flow","responseType","timeSkew","redirectUri","silentCheckSsoRedirectUri","silentCheckSsoFallback","pkceMethod","enableLogging","scope","messageReceiveTimeout","promise","createPromise","initPromise","then","onReady","setSuccess","catch","error","setError","configPromise","loadConfig","doLogin","prompt","options","login","checkSsoSilently","ifrm","createElement","createLoginUrl","setAttribute","style","display","body","appendChild","messageCallback","event","origin","location","contentWindow","source","oauth","parseCallback","data","processCallback","removeChild","removeEventListener","addEventListener","setupCheckLoginIframe","unchanged","processInit","callback","href","history","replaceState","state","newUrl","valid","token","refreshToken","setToken","idToken","onAuthSuccess","scheduleCheckIframe","updateToken","onAuthError","domReady","checkReadyState","readyState","check3pCookiesSupported","generateRandomData","len","array","crypto","msCrypto","getRandomValues","Uint8Array","Array","j","Math","floor","random","generateCodeVerifier","generateRandomString","alphabet","randomData","chars","charCodeAt","String","fromCharCode","apply","generatePkceChallenge","codeVerifier","hashBytes","arrayBuffer","encodedHash","fromByteArray","replace","buildClaimsParameter","requestedAcr","claims","id_token","acr","JSON","stringify","createUUID","nonce","callbackState","encodeURIComponent","baseUrl","action","endpoints","register","authorize","url","clientId","maxAge","loginHint","idpHint","locale","claimsParameter","pkceCodeVerifier","pkceChallenge","add","logout","createLogoutUrl","createRegisterUrl","createAccountUrl","realm","getRealmUrl","undefined","accountManagement","hasRealmRole","role","access","realmAccess","roles","hasResourceRole","resource","resourceAccess","loadUserProfile","req","XMLHttpRequest","open","setRequestHeader","onreadystatechange","status","profile","parse","responseText","send","loadUserInfo","userinfo","userInfo","isTokenExpired","minValidity","tokenParsed","expiresIn","ceil","Date","getTime","isNaN","exec","params","push","withCredentials","timeLocal","tokenResponse","onAuthRefreshSuccess","p","pop","clearToken","onAuthRefreshError","iframePromise","onAuthLogout","authServerUrl","charAt","getOrigin","protocol","hostname","port","code","onActionUpdate","errorData","error_description","access_token","authSuccess","accessToken","fulfillPromise","storedNonce","refreshTokenParsed","idTokenParsed","configUrl","setupOidcEndoints","oidcConfiguration","checkSessionIframe","thirdPartyCookiesIframe","authorization_endpoint","token_endpoint","end_session_endpoint","check_session_iframe","userinfo_endpoint","fileLoaded","oidcProvider","match","substr","oidcProviderConfigUrl","oidcProviderConfig","xhr","responseURL","startsWith","tokenTimeoutHandle","clearTimeout","decodeToken","sessionId","session_state","subject","sub","realm_access","resource_access","iat","onTokenExpired","round","setTimeout","str","decodeURIComponent","escape","atob","hexDigits","s","uuid","join","parseCallbackUrl","oauthState","get","supportedParams","queryIndex","fragmentIndex","parsed","parseCallbackParams","paramsString","oauthParams","result","key","slice","resolve","reject","success","handleSuccess","value","handleError","applyTimeoutToPromise","timeout","errorMessage","timeoutHandle","timeoutPromise","race","finally","iframe","onload","authUrl","iframeOrigin","callbacks","splice","msg","postMessage","type","assign","accountUrl","encodeHash","cordovaOpenWindowWrapper","loginUrl","target","InAppBrowser","shallowCloneCordovaOptions","userOptions","cordovaOptions","Object","keys","reduce","optionName","formatCordovaOptions","createCordovaOptions","hidden","cordovaRedirectUri","ref","completed","closed","closeBrowser","close","reason","logoutUrl","registerUrl","universalLinks","subscribe","unsubscribe","plugins","browsertab","openUrl","LocalStorage","localStorage","setItem","removeItem","cs","clearExpired","time","getItem","expires","err","CookieStorage","getCookie","setCookie","cookieExpiration","minutes","exp","setTime","name","ca","cookie","c","expirationDate","toUTCString","fn","prototype","call","arguments","default"],"mappings":"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","sourcesContent":["import base64 from 'base64-js';\nimport sha256 from 'js-sha256';\n\n/*\n * Copyright 2016 Red Hat, Inc. and/or its affiliates\n * and other contributors as indicated by the @author tags.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nif (typeof Promise === 'undefined') {\n    throw Error('Keycloak requires an environment that supports Promises. Make sure that you include the appropriate polyfill.');\n}\n\nvar loggedConstructorDeprecation = false;\n\nfunction logConstructorDeprecation() {\n    if (!loggedConstructorDeprecation) {\n        loggedConstructorDeprecation = true;\n        console.warn('[KEYCLOAK] Instantiation using the `Keycloak` function has been deprecated and support will be removed in future versions. Use the `new` operator to create an instance instead.');\n    }\n}\n\nvar loggedPromiseDeprecation = false;\n\nfunction logPromiseDeprecation() {\n    if (!loggedPromiseDeprecation) {\n        loggedPromiseDeprecation = true;\n        console.warn('[KEYCLOAK] Usage of legacy style promise methods such as `.error()` and `.success()` has been deprecated and support will be removed in future versions. Use standard style promise methods such as `.then() and `.catch()` instead.');\n    }\n}\n\nfunction Keycloak (config) {\n    if (!(this instanceof Keycloak)) {\n        logConstructorDeprecation();\n        return new Keycloak(config);\n    }\n\n    var kc = this;\n    var adapter;\n    var refreshQueue = [];\n    var callbackStorage;\n\n    var loginIframe = {\n        enable: true,\n        callbackList: [],\n        interval: 5\n    };\n\n    var scripts = document.getElementsByTagName('script');\n    for (var i = 0; i < scripts.length; i++) {\n        if ((scripts[i].src.indexOf('keycloak.js') !== -1 || scripts[i].src.indexOf('keycloak.min.js') !== -1) && scripts[i].src.indexOf('version=') !== -1) {\n            kc.iframeVersion = scripts[i].src.substring(scripts[i].src.indexOf('version=') + 8).split('&')[0];\n        }\n    }\n\n    var useNonce = true;\n    var logInfo = createLogger(console.info);\n    var logWarn = createLogger(console.warn);\n\n    kc.init = function (initOptions) {\n        kc.authenticated = false;\n\n        callbackStorage = createCallbackStorage();\n        var adapters = ['default', 'cordova', 'cordova-native'];\n\n        if (initOptions && adapters.indexOf(initOptions.adapter) > -1) {\n            adapter = loadAdapter(initOptions.adapter);\n        } else if (initOptions && typeof initOptions.adapter === \"object\") {\n            adapter = initOptions.adapter;\n        } else {\n            if (window.Cordova || window.cordova) {\n                adapter = loadAdapter('cordova');\n            } else {\n                adapter = loadAdapter();\n            }\n        }\n\n        if (initOptions) {\n            if (typeof initOptions.useNonce !== 'undefined') {\n                useNonce = initOptions.useNonce;\n            }\n\n            if (typeof initOptions.checkLoginIframe !== 'undefined') {\n                loginIframe.enable = initOptions.checkLoginIframe;\n            }\n\n            if (initOptions.checkLoginIframeInterval) {\n                loginIframe.interval = initOptions.checkLoginIframeInterval;\n            }\n\n            if (initOptions.onLoad === 'login-required') {\n                kc.loginRequired = true;\n            }\n\n            if (initOptions.responseMode) {\n                if (initOptions.responseMode === 'query' || initOptions.responseMode === 'fragment') {\n                    kc.responseMode = initOptions.responseMode;\n                } else {\n                    throw 'Invalid value for responseMode';\n                }\n            }\n\n            if (initOptions.flow) {\n                switch (initOptions.flow) {\n                    case 'standard':\n                        kc.responseType = 'code';\n                        break;\n                    case 'implicit':\n                        kc.responseType = 'id_token token';\n                        break;\n                    case 'hybrid':\n                        kc.responseType = 'code id_token token';\n                        break;\n                    default:\n                        throw 'Invalid value for flow';\n                }\n                kc.flow = initOptions.flow;\n            }\n\n            if (initOptions.timeSkew != null) {\n                kc.timeSkew = initOptions.timeSkew;\n            }\n\n            if(initOptions.redirectUri) {\n                kc.redirectUri = initOptions.redirectUri;\n            }\n\n            if (initOptions.silentCheckSsoRedirectUri) {\n                kc.silentCheckSsoRedirectUri = initOptions.silentCheckSsoRedirectUri;\n            }\n\n            if (typeof initOptions.silentCheckSsoFallback === 'boolean') {\n                kc.silentCheckSsoFallback = initOptions.silentCheckSsoFallback;\n            } else {\n                kc.silentCheckSsoFallback = true;\n            }\n\n            if (initOptions.pkceMethod) {\n                if (initOptions.pkceMethod !== \"S256\") {\n                    throw 'Invalid value for pkceMethod';\n                }\n                kc.pkceMethod = initOptions.pkceMethod;\n            }\n\n            if (typeof initOptions.enableLogging === 'boolean') {\n                kc.enableLogging = initOptions.enableLogging;\n            } else {\n                kc.enableLogging = false;\n            }\n\n            if (typeof initOptions.scope === 'string') {\n                kc.scope = initOptions.scope;\n            }\n\n            if (typeof initOptions.messageReceiveTimeout === 'number' && initOptions.messageReceiveTimeout > 0) {\n                kc.messageReceiveTimeout = initOptions.messageReceiveTimeout;\n            } else {\n                kc.messageReceiveTimeout = 10000;\n            }\n        }\n\n        if (!kc.responseMode) {\n            kc.responseMode = 'fragment';\n        }\n        if (!kc.responseType) {\n            kc.responseType = 'code';\n            kc.flow = 'standard';\n        }\n\n        var promise = createPromise();\n\n        var initPromise = createPromise();\n        initPromise.promise.then(function() {\n            kc.onReady && kc.onReady(kc.authenticated);\n            promise.setSuccess(kc.authenticated);\n        }).catch(function(error) {\n            promise.setError(error);\n        });\n\n        var configPromise = loadConfig();\n\n        function onLoad() {\n            var doLogin = function(prompt) {\n                if (!prompt) {\n                    options.prompt = 'none';\n                }\n\n                kc.login(options).then(function () {\n                    initPromise.setSuccess();\n                }).catch(function (error) {\n                    initPromise.setError(error);\n                });\n            };\n\n            var checkSsoSilently = function() {\n                var ifrm = document.createElement(\"iframe\");\n                var src = kc.createLoginUrl({prompt: 'none', redirectUri: kc.silentCheckSsoRedirectUri});\n                ifrm.setAttribute(\"src\", src);\n                ifrm.setAttribute(\"title\", \"keycloak-silent-check-sso\");\n                ifrm.style.display = \"none\";\n                document.body.appendChild(ifrm);\n\n                var messageCallback = function(event) {\n                    if (event.origin !== window.location.origin || ifrm.contentWindow !== event.source) {\n                        return;\n                    }\n\n                    var oauth = parseCallback(event.data);\n                    processCallback(oauth, initPromise);\n\n                    document.body.removeChild(ifrm);\n                    window.removeEventListener(\"message\", messageCallback);\n                };\n\n                window.addEventListener(\"message\", messageCallback);\n            };\n\n            var options = {};\n            switch (initOptions.onLoad) {\n                case 'check-sso':\n                    if (loginIframe.enable) {\n                        setupCheckLoginIframe().then(function() {\n                            checkLoginIframe().then(function (unchanged) {\n                                if (!unchanged) {\n                                    kc.silentCheckSsoRedirectUri ? checkSsoSilently() : doLogin(false);\n                                } else {\n                                    initPromise.setSuccess();\n                                }\n                            }).catch(function (error) {\n                                initPromise.setError(error);\n                            });\n                        });\n                    } else {\n                        kc.silentCheckSsoRedirectUri ? checkSsoSilently() : doLogin(false);\n                    }\n                    break;\n                case 'login-required':\n                    doLogin(true);\n                    break;\n                default:\n                    throw 'Invalid value for onLoad';\n            }\n        }\n\n        function processInit() {\n            var callback = parseCallback(window.location.href);\n\n            if (callback) {\n                window.history.replaceState(window.history.state, null, callback.newUrl);\n            }\n\n            if (callback && callback.valid) {\n                return setupCheckLoginIframe().then(function() {\n                    processCallback(callback, initPromise);\n                }).catch(function (error) {\n                    initPromise.setError(error);\n                });\n            } else if (initOptions) {\n                if (initOptions.token && initOptions.refreshToken) {\n                    setToken(initOptions.token, initOptions.refreshToken, initOptions.idToken);\n\n                    if (loginIframe.enable) {\n                        setupCheckLoginIframe().then(function() {\n                            checkLoginIframe().then(function (unchanged) {\n                                if (unchanged) {\n                                    kc.onAuthSuccess && kc.onAuthSuccess();\n                                    initPromise.setSuccess();\n                                    scheduleCheckIframe();\n                                } else {\n                                    initPromise.setSuccess();\n                                }\n                            }).catch(function (error) {\n                                initPromise.setError(error);\n                            });\n                        });\n                    } else {\n                        kc.updateToken(-1).then(function() {\n                            kc.onAuthSuccess && kc.onAuthSuccess();\n                            initPromise.setSuccess();\n                        }).catch(function(error) {\n                            kc.onAuthError && kc.onAuthError();\n                            if (initOptions.onLoad) {\n                                onLoad();\n                            } else {\n                                initPromise.setError(error);\n                            }\n                        });\n                    }\n                } else if (initOptions.onLoad) {\n                    onLoad();\n                } else {\n                    initPromise.setSuccess();\n                }\n            } else {\n                initPromise.setSuccess();\n            }\n        }\n\n        function domReady() {\n            var promise = createPromise();\n\n            var checkReadyState = function () {\n                if (document.readyState === 'interactive' || document.readyState === 'complete') {\n                    document.removeEventListener('readystatechange', checkReadyState);\n                    promise.setSuccess();\n                }\n            };\n            document.addEventListener('readystatechange', checkReadyState);\n\n            checkReadyState(); // just in case the event was already fired and we missed it (in case the init is done later than at the load time, i.e. it's done from code)\n\n            return promise.promise;\n        }\n\n        configPromise.then(function () {\n            domReady()\n                .then(check3pCookiesSupported)\n                .then(processInit)\n                .catch(function (error) {\n                    promise.setError(error);\n                });\n        });\n        configPromise.catch(function (error) {\n            promise.setError(error);\n        });\n\n        return promise.promise;\n    };\n\n    kc.login = function (options) {\n        return adapter.login(options);\n    };\n\n    function generateRandomData(len) {\n        // use web crypto APIs if possible\n        var array = null;\n        var crypto = window.crypto || window.msCrypto;\n        if (crypto && crypto.getRandomValues && window.Uint8Array) {\n            array = new Uint8Array(len);\n            crypto.getRandomValues(array);\n            return array;\n        }\n\n        // fallback to Math random\n        array = new Array(len);\n        for (var j = 0; j < array.length; j++) {\n            array[j] = Math.floor(256 * Math.random());\n        }\n        return array;\n    }\n\n    function generateCodeVerifier(len) {\n        return generateRandomString(len, 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789');\n    }\n\n    function generateRandomString(len, alphabet){\n        var randomData = generateRandomData(len);\n        var chars = new Array(len);\n        for (var i = 0; i < len; i++) {\n            chars[i] = alphabet.charCodeAt(randomData[i] % alphabet.length);\n        }\n        return String.fromCharCode.apply(null, chars);\n    }\n\n    function generatePkceChallenge(pkceMethod, codeVerifier) {\n        switch (pkceMethod) {\n            // The use of the \"plain\" method is considered insecure and therefore not supported.\n            case \"S256\":\n                // hash codeVerifier, then encode as url-safe base64 without padding\n                var hashBytes = new Uint8Array(sha256.arrayBuffer(codeVerifier));\n                var encodedHash = base64.fromByteArray(hashBytes)\n                    .replace(/\\+/g, '-')\n                    .replace(/\\//g, '_')\n                    .replace(/\\=/g, '');\n                return encodedHash;\n            default:\n                throw 'Invalid value for pkceMethod';\n        }\n    }\n\n    function buildClaimsParameter(requestedAcr){\n        var claims = {\n            id_token: {\n                acr: requestedAcr\n            }\n        };\n        return JSON.stringify(claims);\n    }\n\n    kc.createLoginUrl = function(options) {\n        var state = createUUID();\n        var nonce = createUUID();\n\n        var redirectUri = adapter.redirectUri(options);\n\n        var callbackState = {\n            state: state,\n            nonce: nonce,\n            redirectUri: encodeURIComponent(redirectUri)\n        };\n\n        if (options && options.prompt) {\n            callbackState.prompt = options.prompt;\n        }\n\n        var baseUrl;\n        if (options && options.action == 'register') {\n            baseUrl = kc.endpoints.register();\n        } else {\n            baseUrl = kc.endpoints.authorize();\n        }\n\n        var scope = options && options.scope || kc.scope;\n        if (!scope) {\n            // if scope is not set, default to \"openid\"\n            scope = \"openid\";\n        } else if (scope.indexOf(\"openid\") === -1) {\n            // if openid scope is missing, prefix the given scopes with it\n            scope = \"openid \" + scope;\n        }\n\n        var url = baseUrl\n            + '?client_id=' + encodeURIComponent(kc.clientId)\n            + '&redirect_uri=' + encodeURIComponent(redirectUri)\n            + '&state=' + encodeURIComponent(state)\n            + '&response_mode=' + encodeURIComponent(kc.responseMode)\n            + '&response_type=' + encodeURIComponent(kc.responseType)\n            + '&scope=' + encodeURIComponent(scope);\n        if (useNonce) {\n            url = url + '&nonce=' + encodeURIComponent(nonce);\n        }\n\n        if (options && options.prompt) {\n            url += '&prompt=' + encodeURIComponent(options.prompt);\n        }\n\n        if (options && options.maxAge) {\n            url += '&max_age=' + encodeURIComponent(options.maxAge);\n        }\n\n        if (options && options.loginHint) {\n            url += '&login_hint=' + encodeURIComponent(options.loginHint);\n        }\n\n        if (options && options.idpHint) {\n            url += '&kc_idp_hint=' + encodeURIComponent(options.idpHint);\n        }\n\n        if (options && options.action && options.action != 'register') {\n            url += '&kc_action=' + encodeURIComponent(options.action);\n        }\n\n        if (options && options.locale) {\n            url += '&ui_locales=' + encodeURIComponent(options.locale);\n        }\n\n        if (options && options.acr) {\n            var claimsParameter = buildClaimsParameter(options.acr);\n            url += '&claims=' + encodeURIComponent(claimsParameter);\n        }\n\n        if (kc.pkceMethod) {\n            var codeVerifier = generateCodeVerifier(96);\n            callbackState.pkceCodeVerifier = codeVerifier;\n            var pkceChallenge = generatePkceChallenge(kc.pkceMethod, codeVerifier);\n            url += '&code_challenge=' + pkceChallenge;\n            url += '&code_challenge_method=' + kc.pkceMethod;\n        }\n\n        callbackStorage.add(callbackState);\n\n        return url;\n    };\n\n    kc.logout = function(options) {\n        return adapter.logout(options);\n    };\n\n    kc.createLogoutUrl = function(options) {\n        var url = kc.endpoints.logout()\n            + '?client_id=' + encodeURIComponent(kc.clientId)\n            + '&post_logout_redirect_uri=' + encodeURIComponent(adapter.redirectUri(options, false));\n\n        if (kc.idToken) {\n            url += '&id_token_hint=' + encodeURIComponent(kc.idToken);\n        }\n\n        return url;\n    };\n\n    kc.register = function (options) {\n        return adapter.register(options);\n    };\n\n    kc.createRegisterUrl = function(options) {\n        if (!options) {\n            options = {};\n        }\n        options.action = 'register';\n        return kc.createLoginUrl(options);\n    };\n\n    kc.createAccountUrl = function(options) {\n        var realm = getRealmUrl();\n        var url = undefined;\n        if (typeof realm !== 'undefined') {\n            url = realm\n            + '/account'\n            + '?referrer=' + encodeURIComponent(kc.clientId)\n            + '&referrer_uri=' + encodeURIComponent(adapter.redirectUri(options));\n        }\n        return url;\n    };\n\n    kc.accountManagement = function() {\n        return adapter.accountManagement();\n    };\n\n    kc.hasRealmRole = function (role) {\n        var access = kc.realmAccess;\n        return !!access && access.roles.indexOf(role) >= 0;\n    };\n\n    kc.hasResourceRole = function(role, resource) {\n        if (!kc.resourceAccess) {\n            return false;\n        }\n\n        var access = kc.resourceAccess[resource || kc.clientId];\n        return !!access && access.roles.indexOf(role) >= 0;\n    };\n\n    kc.loadUserProfile = function() {\n        var url = getRealmUrl() + '/account';\n        var req = new XMLHttpRequest();\n        req.open('GET', url, true);\n        req.setRequestHeader('Accept', 'application/json');\n        req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n\n        var promise = createPromise();\n\n        req.onreadystatechange = function () {\n            if (req.readyState == 4) {\n                if (req.status == 200) {\n                    kc.profile = JSON.parse(req.responseText);\n                    promise.setSuccess(kc.profile);\n                } else {\n                    promise.setError();\n                }\n            }\n        };\n\n        req.send();\n\n        return promise.promise;\n    };\n\n    kc.loadUserInfo = function() {\n        var url = kc.endpoints.userinfo();\n        var req = new XMLHttpRequest();\n        req.open('GET', url, true);\n        req.setRequestHeader('Accept', 'application/json');\n        req.setRequestHeader('Authorization', 'bearer ' + kc.token);\n\n        var promise = createPromise();\n\n        req.onreadystatechange = function () {\n            if (req.readyState == 4) {\n                if (req.status == 200) {\n                    kc.userInfo = JSON.parse(req.responseText);\n                    promise.setSuccess(kc.userInfo);\n                } else {\n                    promise.setError();\n                }\n            }\n        };\n\n        req.send();\n\n        return promise.promise;\n    };\n\n    kc.isTokenExpired = function(minValidity) {\n        if (!kc.tokenParsed || (!kc.refreshToken && kc.flow != 'implicit' )) {\n            throw 'Not authenticated';\n        }\n\n        if (kc.timeSkew == null) {\n            logInfo('[KEYCLOAK] Unable to determine if token is expired as timeskew is not set');\n            return true;\n        }\n\n        var expiresIn = kc.tokenParsed['exp'] - Math.ceil(new Date().getTime() / 1000) + kc.timeSkew;\n        if (minValidity) {\n            if (isNaN(minValidity)) {\n                throw 'Invalid minValidity';\n            }\n            expiresIn -= minValidity;\n        }\n        return expiresIn < 0;\n    };\n\n    kc.updateToken = function(minValidity) {\n        var promise = createPromise();\n\n        if (!kc.refreshToken) {\n            promise.setError();\n            return promise.promise;\n        }\n\n        minValidity = minValidity || 5;\n\n        var exec = function() {\n            var refreshToken = false;\n            if (minValidity == -1) {\n                refreshToken = true;\n                logInfo('[KEYCLOAK] Refreshing token: forced refresh');\n            } else if (!kc.tokenParsed || kc.isTokenExpired(minValidity)) {\n                refreshToken = true;\n                logInfo('[KEYCLOAK] Refreshing token: token expired');\n            }\n\n            if (!refreshToken) {\n                promise.setSuccess(false);\n            } else {\n                var params = 'grant_type=refresh_token&' + 'refresh_token=' + kc.refreshToken;\n                var url = kc.endpoints.token();\n\n                refreshQueue.push(promise);\n\n                if (refreshQueue.length == 1) {\n                    var req = new XMLHttpRequest();\n                    req.open('POST', url, true);\n                    req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n                    req.withCredentials = true;\n\n                    params += '&client_id=' + encodeURIComponent(kc.clientId);\n\n                    var timeLocal = new Date().getTime();\n\n                    req.onreadystatechange = function () {\n                        if (req.readyState == 4) {\n                            if (req.status == 200) {\n                                logInfo('[KEYCLOAK] Token refreshed');\n\n                                timeLocal = (timeLocal + new Date().getTime()) / 2;\n\n                                var tokenResponse = JSON.parse(req.responseText);\n\n                                setToken(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], timeLocal);\n\n                                kc.onAuthRefreshSuccess && kc.onAuthRefreshSuccess();\n                                for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                                    p.setSuccess(true);\n                                }\n                            } else {\n                                logWarn('[KEYCLOAK] Failed to refresh token');\n\n                                if (req.status == 400) {\n                                    kc.clearToken();\n                                }\n\n                                kc.onAuthRefreshError && kc.onAuthRefreshError();\n                                for (var p = refreshQueue.pop(); p != null; p = refreshQueue.pop()) {\n                                    p.setError(true);\n                                }\n                            }\n                        }\n                    };\n\n                    req.send(params);\n                }\n            }\n        };\n\n        if (loginIframe.enable) {\n            var iframePromise = checkLoginIframe();\n            iframePromise.then(function() {\n                exec();\n            }).catch(function(error) {\n                promise.setError(error);\n            });\n        } else {\n            exec();\n        }\n\n        return promise.promise;\n    };\n\n    kc.clearToken = function() {\n        if (kc.token) {\n            setToken(null, null, null);\n            kc.onAuthLogout && kc.onAuthLogout();\n            if (kc.loginRequired) {\n                kc.login();\n            }\n        }\n    };\n\n    function getRealmUrl() {\n        if (typeof kc.authServerUrl !== 'undefined') {\n            if (kc.authServerUrl.charAt(kc.authServerUrl.length - 1) == '/') {\n                return kc.authServerUrl + 'realms/' + encodeURIComponent(kc.realm);\n            } else {\n                return kc.authServerUrl + '/realms/' + encodeURIComponent(kc.realm);\n            }\n        } else {\n            return undefined;\n        }\n    }\n\n    function getOrigin() {\n        if (!window.location.origin) {\n            return window.location.protocol + \"//\" + window.location.hostname + (window.location.port ? ':' + window.location.port: '');\n        } else {\n            return window.location.origin;\n        }\n    }\n\n    function processCallback(oauth, promise) {\n        var code = oauth.code;\n        var error = oauth.error;\n        var prompt = oauth.prompt;\n\n        var timeLocal = new Date().getTime();\n\n        if (oauth['kc_action_status']) {\n            kc.onActionUpdate && kc.onActionUpdate(oauth['kc_action_status']);\n        }\n\n        if (error) {\n            if (prompt != 'none') {\n                var errorData = { error: error, error_description: oauth.error_description };\n                kc.onAuthError && kc.onAuthError(errorData);\n                promise && promise.setError(errorData);\n            } else {\n                promise && promise.setSuccess();\n            }\n            return;\n        } else if ((kc.flow != 'standard') && (oauth.access_token || oauth.id_token)) {\n            authSuccess(oauth.access_token, null, oauth.id_token, true);\n        }\n\n        if ((kc.flow != 'implicit') && code) {\n            var params = 'code=' + code + '&grant_type=authorization_code';\n            var url = kc.endpoints.token();\n\n            var req = new XMLHttpRequest();\n            req.open('POST', url, true);\n            req.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');\n\n            params += '&client_id=' + encodeURIComponent(kc.clientId);\n            params += '&redirect_uri=' + oauth.redirectUri;\n\n            if (oauth.pkceCodeVerifier) {\n                params += '&code_verifier=' + oauth.pkceCodeVerifier;\n            }\n\n            req.withCredentials = true;\n\n            req.onreadystatechange = function() {\n                if (req.readyState == 4) {\n                    if (req.status == 200) {\n\n                        var tokenResponse = JSON.parse(req.responseText);\n                        authSuccess(tokenResponse['access_token'], tokenResponse['refresh_token'], tokenResponse['id_token'], kc.flow === 'standard');\n                        scheduleCheckIframe();\n                    } else {\n                        kc.onAuthError && kc.onAuthError();\n                        promise && promise.setError();\n                    }\n                }\n            };\n\n            req.send(params);\n        }\n\n        function authSuccess(accessToken, refreshToken, idToken, fulfillPromise) {\n            timeLocal = (timeLocal + new Date().getTime()) / 2;\n\n            setToken(accessToken, refreshToken, idToken, timeLocal);\n\n            if (useNonce && ((kc.tokenParsed && kc.tokenParsed.nonce != oauth.storedNonce) ||\n                (kc.refreshTokenParsed && kc.refreshTokenParsed.nonce != oauth.storedNonce) ||\n                (kc.idTokenParsed && kc.idTokenParsed.nonce != oauth.storedNonce))) {\n\n                logInfo('[KEYCLOAK] Invalid nonce, clearing token');\n                kc.clearToken();\n                promise && promise.setError();\n            } else {\n                if (fulfillPromise) {\n                    kc.onAuthSuccess && kc.onAuthSuccess();\n                    promise && promise.setSuccess();\n                }\n            }\n        }\n\n    }\n\n    function loadConfig(url) {\n        var promise = createPromise();\n        var configUrl;\n\n        if (!config) {\n            configUrl = 'keycloak.json';\n        } else if (typeof config === 'string') {\n            configUrl = config;\n        }\n\n        function setupOidcEndoints(oidcConfiguration) {\n            if (! oidcConfiguration) {\n                kc.endpoints = {\n                    authorize: function() {\n                        return getRealmUrl() + '/protocol/openid-connect/auth';\n                    },\n                    token: function() {\n                        return getRealmUrl() + '/protocol/openid-connect/token';\n                    },\n                    logout: function() {\n                        return getRealmUrl() + '/protocol/openid-connect/logout';\n                    },\n                    checkSessionIframe: function() {\n                        var src = getRealmUrl() + '/protocol/openid-connect/login-status-iframe.html';\n                        if (kc.iframeVersion) {\n                            src = src + '?version=' + kc.iframeVersion;\n                        }\n                        return src;\n                    },\n                    thirdPartyCookiesIframe: function() {\n                        var src = getRealmUrl() + '/protocol/openid-connect/3p-cookies/step1.html';\n                        if (kc.iframeVersion) {\n                            src = src + '?version=' + kc.iframeVersion;\n                        }\n                        return src;\n                    },\n                    register: function() {\n                        return getRealmUrl() + '/protocol/openid-connect/registrations';\n                    },\n                    userinfo: function() {\n                        return getRealmUrl() + '/protocol/openid-connect/userinfo';\n                    }\n                };\n            } else {\n                kc.endpoints = {\n                    authorize: function() {\n                        return oidcConfiguration.authorization_endpoint;\n                    },\n                    token: function() {\n                        return oidcConfiguration.token_endpoint;\n                    },\n                    logout: function() {\n                        if (!oidcConfiguration.end_session_endpoint) {\n                            throw \"Not supported by the OIDC server\";\n                        }\n                        return oidcConfiguration.end_session_endpoint;\n                    },\n                    checkSessionIframe: function() {\n                        if (!oidcConfiguration.check_session_iframe) {\n                            throw \"Not supported by the OIDC server\";\n                        }\n                        return oidcConfiguration.check_session_iframe;\n                    },\n                    register: function() {\n                        throw 'Redirection to \"Register user\" page not supported in standard OIDC mode';\n                    },\n                    userinfo: function() {\n                        if (!oidcConfiguration.userinfo_endpoint) {\n                            throw \"Not supported by the OIDC server\";\n                        }\n                        return oidcConfiguration.userinfo_endpoint;\n                    }\n                };\n            }\n        }\n\n        if (configUrl) {\n            var req = new XMLHttpRequest();\n            req.open('GET', configUrl, true);\n            req.setRequestHeader('Accept', 'application/json');\n\n            req.onreadystatechange = function () {\n                if (req.readyState == 4) {\n                    if (req.status == 200 || fileLoaded(req)) {\n                        var config = JSON.parse(req.responseText);\n\n                        kc.authServerUrl = config['auth-server-url'];\n                        kc.realm = config['realm'];\n                        kc.clientId = config['resource'];\n                        setupOidcEndoints(null);\n                        promise.setSuccess();\n                    } else {\n                        promise.setError();\n                    }\n                }\n            };\n\n            req.send();\n        } else {\n            if (!config.clientId) {\n                throw 'clientId missing';\n            }\n\n            kc.clientId = config.clientId;\n\n            var oidcProvider = config['oidcProvider'];\n            if (!oidcProvider) {\n                if (!config['url']) {\n                    var scripts = document.getElementsByTagName('script');\n                    for (var i = 0; i < scripts.length; i++) {\n                        if (scripts[i].src.match(/.*keycloak\\.js/)) {\n                            config.url = scripts[i].src.substr(0, scripts[i].src.indexOf('/js/keycloak.js'));\n                            break;\n                        }\n                    }\n                }\n                if (!config.realm) {\n                    throw 'realm missing';\n                }\n\n                kc.authServerUrl = config.url;\n                kc.realm = config.realm;\n                setupOidcEndoints(null);\n                promise.setSuccess();\n            } else {\n                if (typeof oidcProvider === 'string') {\n                    var oidcProviderConfigUrl;\n                    if (oidcProvider.charAt(oidcProvider.length - 1) == '/') {\n                        oidcProviderConfigUrl = oidcProvider + '.well-known/openid-configuration';\n                    } else {\n                        oidcProviderConfigUrl = oidcProvider + '/.well-known/openid-configuration';\n                    }\n                    var req = new XMLHttpRequest();\n                    req.open('GET', oidcProviderConfigUrl, true);\n                    req.setRequestHeader('Accept', 'application/json');\n\n                    req.onreadystatechange = function () {\n                        if (req.readyState == 4) {\n                            if (req.status == 200 || fileLoaded(req)) {\n                                var oidcProviderConfig = JSON.parse(req.responseText);\n                                setupOidcEndoints(oidcProviderConfig);\n                                promise.setSuccess();\n                            } else {\n                                promise.setError();\n                            }\n                        }\n                    };\n\n                    req.send();\n                } else {\n                    setupOidcEndoints(oidcProvider);\n                    promise.setSuccess();\n                }\n            }\n        }\n\n        return promise.promise;\n    }\n\n    function fileLoaded(xhr) {\n        return xhr.status == 0 && xhr.responseText && xhr.responseURL.startsWith('file:');\n    }\n\n    function setToken(token, refreshToken, idToken, timeLocal) {\n        if (kc.tokenTimeoutHandle) {\n            clearTimeout(kc.tokenTimeoutHandle);\n            kc.tokenTimeoutHandle = null;\n        }\n\n        if (refreshToken) {\n            kc.refreshToken = refreshToken;\n            kc.refreshTokenParsed = decodeToken(refreshToken);\n        } else {\n            delete kc.refreshToken;\n            delete kc.refreshTokenParsed;\n        }\n\n        if (idToken) {\n            kc.idToken = idToken;\n            kc.idTokenParsed = decodeToken(idToken);\n        } else {\n            delete kc.idToken;\n            delete kc.idTokenParsed;\n        }\n\n        if (token) {\n            kc.token = token;\n            kc.tokenParsed = decodeToken(token);\n            kc.sessionId = kc.tokenParsed.session_state;\n            kc.authenticated = true;\n            kc.subject = kc.tokenParsed.sub;\n            kc.realmAccess = kc.tokenParsed.realm_access;\n            kc.resourceAccess = kc.tokenParsed.resource_access;\n\n            if (timeLocal) {\n                kc.timeSkew = Math.floor(timeLocal / 1000) - kc.tokenParsed.iat;\n            }\n\n            if (kc.timeSkew != null) {\n                logInfo('[KEYCLOAK] Estimated time difference between browser and server is ' + kc.timeSkew + ' seconds');\n\n                if (kc.onTokenExpired) {\n                    var expiresIn = (kc.tokenParsed['exp'] - (new Date().getTime() / 1000) + kc.timeSkew) * 1000;\n                    logInfo('[KEYCLOAK] Token expires in ' + Math.round(expiresIn / 1000) + ' s');\n                    if (expiresIn <= 0) {\n                        kc.onTokenExpired();\n                    } else {\n                        kc.tokenTimeoutHandle = setTimeout(kc.onTokenExpired, expiresIn);\n                    }\n                }\n            }\n        } else {\n            delete kc.token;\n            delete kc.tokenParsed;\n            delete kc.subject;\n            delete kc.realmAccess;\n            delete kc.resourceAccess;\n\n            kc.authenticated = false;\n        }\n    }\n\n    function decodeToken(str) {\n        str = str.split('.')[1];\n\n        str = str.replace(/-/g, '+');\n        str = str.replace(/_/g, '/');\n        switch (str.length % 4) {\n            case 0:\n                break;\n            case 2:\n                str += '==';\n                break;\n            case 3:\n                str += '=';\n                break;\n            default:\n                throw 'Invalid token';\n        }\n\n        str = decodeURIComponent(escape(atob(str)));\n\n        str = JSON.parse(str);\n        return str;\n    }\n\n    function createUUID() {\n        var hexDigits = '0123456789abcdef';\n        var s = generateRandomString(36, hexDigits).split(\"\");\n        s[14] = '4';\n        s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);\n        s[8] = s[13] = s[18] = s[23] = '-';\n        var uuid = s.join('');\n        return uuid;\n    }\n\n    function parseCallback(url) {\n        var oauth = parseCallbackUrl(url);\n        if (!oauth) {\n            return;\n        }\n\n        var oauthState = callbackStorage.get(oauth.state);\n\n        if (oauthState) {\n            oauth.valid = true;\n            oauth.redirectUri = oauthState.redirectUri;\n            oauth.storedNonce = oauthState.nonce;\n            oauth.prompt = oauthState.prompt;\n            oauth.pkceCodeVerifier = oauthState.pkceCodeVerifier;\n        }\n\n        return oauth;\n    }\n\n    function parseCallbackUrl(url) {\n        var supportedParams;\n        switch (kc.flow) {\n            case 'standard':\n                supportedParams = ['code', 'state', 'session_state', 'kc_action_status'];\n                break;\n            case 'implicit':\n                supportedParams = ['access_token', 'token_type', 'id_token', 'state', 'session_state', 'expires_in', 'kc_action_status'];\n                break;\n            case 'hybrid':\n                supportedParams = ['access_token', 'token_type', 'id_token', 'code', 'state', 'session_state', 'expires_in', 'kc_action_status'];\n                break;\n        }\n\n        supportedParams.push('error');\n        supportedParams.push('error_description');\n        supportedParams.push('error_uri');\n\n        var queryIndex = url.indexOf('?');\n        var fragmentIndex = url.indexOf('#');\n\n        var newUrl;\n        var parsed;\n\n        if (kc.responseMode === 'query' && queryIndex !== -1) {\n            newUrl = url.substring(0, queryIndex);\n            parsed = parseCallbackParams(url.substring(queryIndex + 1, fragmentIndex !== -1 ? fragmentIndex : url.length), supportedParams);\n            if (parsed.paramsString !== '') {\n                newUrl += '?' + parsed.paramsString;\n            }\n            if (fragmentIndex !== -1) {\n                newUrl += url.substring(fragmentIndex);\n            }\n        } else if (kc.responseMode === 'fragment' && fragmentIndex !== -1) {\n            newUrl = url.substring(0, fragmentIndex);\n            parsed = parseCallbackParams(url.substring(fragmentIndex + 1), supportedParams);\n            if (parsed.paramsString !== '') {\n                newUrl += '#' + parsed.paramsString;\n            }\n        }\n\n        if (parsed && parsed.oauthParams) {\n            if (kc.flow === 'standard' || kc.flow === 'hybrid') {\n                if ((parsed.oauthParams.code || parsed.oauthParams.error) && parsed.oauthParams.state) {\n                    parsed.oauthParams.newUrl = newUrl;\n                    return parsed.oauthParams;\n                }\n            } else if (kc.flow === 'implicit') {\n                if ((parsed.oauthParams.access_token || parsed.oauthParams.error) && parsed.oauthParams.state) {\n                    parsed.oauthParams.newUrl = newUrl;\n                    return parsed.oauthParams;\n                }\n            }\n        }\n    }\n\n    function parseCallbackParams(paramsString, supportedParams) {\n        var p = paramsString.split('&');\n        var result = {\n            paramsString: '',\n            oauthParams: {}\n        };\n        for (var i = 0; i < p.length; i++) {\n            var split = p[i].indexOf(\"=\");\n            var key = p[i].slice(0, split);\n            if (supportedParams.indexOf(key) !== -1) {\n                result.oauthParams[key] = p[i].slice(split + 1);\n            } else {\n                if (result.paramsString !== '') {\n                    result.paramsString += '&';\n                }\n                result.paramsString += p[i];\n            }\n        }\n        return result;\n    }\n\n    function createPromise() {\n        // Need to create a native Promise which also preserves the\n        // interface of the custom promise type previously used by the API\n        var p = {\n            setSuccess: function(result) {\n                p.resolve(result);\n            },\n\n            setError: function(result) {\n                p.reject(result);\n            }\n        };\n        p.promise = new Promise(function(resolve, reject) {\n            p.resolve = resolve;\n            p.reject = reject;\n        });\n\n        p.promise.success = function(callback) {\n            logPromiseDeprecation();\n\n            this.then(function handleSuccess(value) {\n                callback(value);\n            });\n\n            return this;\n        };\n\n        p.promise.error = function(callback) {\n            logPromiseDeprecation();\n\n            this.catch(function handleError(error) {\n                callback(error);\n            });\n\n            return this;\n        };\n\n        return p;\n    }\n\n    // Function to extend existing native Promise with timeout\n    function applyTimeoutToPromise(promise, timeout, errorMessage) {\n        var timeoutHandle = null;\n        var timeoutPromise = new Promise(function (resolve, reject) {\n            timeoutHandle = setTimeout(function () {\n                reject({ \"error\": errorMessage || \"Promise is not settled within timeout of \" + timeout + \"ms\" });\n            }, timeout);\n        });\n\n        return Promise.race([promise, timeoutPromise]).finally(function () {\n            clearTimeout(timeoutHandle);\n        });\n    }\n\n    function setupCheckLoginIframe() {\n        var promise = createPromise();\n\n        if (!loginIframe.enable) {\n            promise.setSuccess();\n            return promise.promise;\n        }\n\n        if (loginIframe.iframe) {\n            promise.setSuccess();\n            return promise.promise;\n        }\n\n        var iframe = document.createElement('iframe');\n        loginIframe.iframe = iframe;\n\n        iframe.onload = function() {\n            var authUrl = kc.endpoints.authorize();\n            if (authUrl.charAt(0) === '/') {\n                loginIframe.iframeOrigin = getOrigin();\n            } else {\n                loginIframe.iframeOrigin = authUrl.substring(0, authUrl.indexOf('/', 8));\n            }\n            promise.setSuccess();\n        };\n\n        var src = kc.endpoints.checkSessionIframe();\n        iframe.setAttribute('src', src );\n        iframe.setAttribute('title', 'keycloak-session-iframe' );\n        iframe.style.display = 'none';\n        document.body.appendChild(iframe);\n\n        var messageCallback = function(event) {\n            if ((event.origin !== loginIframe.iframeOrigin) || (loginIframe.iframe.contentWindow !== event.source)) {\n                return;\n            }\n\n            if (!(event.data == 'unchanged' || event.data == 'changed' || event.data == 'error')) {\n                return;\n            }\n\n\n            if (event.data != 'unchanged') {\n                kc.clearToken();\n            }\n\n            var callbacks = loginIframe.callbackList.splice(0, loginIframe.callbackList.length);\n\n            for (var i = callbacks.length - 1; i >= 0; --i) {\n                var promise = callbacks[i];\n                if (event.data == 'error') {\n                    promise.setError();\n                } else {\n                    promise.setSuccess(event.data == 'unchanged');\n                }\n            }\n        };\n\n        window.addEventListener('message', messageCallback, false);\n\n        return promise.promise;\n    }\n\n    function scheduleCheckIframe() {\n        if (loginIframe.enable) {\n            if (kc.token) {\n                setTimeout(function() {\n                    checkLoginIframe().then(function(unchanged) {\n                        if (unchanged) {\n                            scheduleCheckIframe();\n                        }\n                    });\n                }, loginIframe.interval * 1000);\n            }\n        }\n    }\n\n    function checkLoginIframe() {\n        var promise = createPromise();\n\n        if (loginIframe.iframe && loginIframe.iframeOrigin ) {\n            var msg = kc.clientId + ' ' + (kc.sessionId ? kc.sessionId : '');\n            loginIframe.callbackList.push(promise);\n            var origin = loginIframe.iframeOrigin;\n            if (loginIframe.callbackList.length == 1) {\n                loginIframe.iframe.contentWindow.postMessage(msg, origin);\n            }\n        } else {\n            promise.setSuccess();\n        }\n\n        return promise.promise;\n    }\n\n    function check3pCookiesSupported() {\n        var promise = createPromise();\n\n        if (loginIframe.enable || kc.silentCheckSsoRedirectUri) {\n            var iframe = document.createElement('iframe');\n            iframe.setAttribute('src', kc.endpoints.thirdPartyCookiesIframe());\n            iframe.setAttribute('title', 'keycloak-3p-check-iframe' );\n            iframe.style.display = 'none';\n            document.body.appendChild(iframe);\n\n            var messageCallback = function(event) {\n                if (iframe.contentWindow !== event.source) {\n                    return;\n                }\n\n                if (event.data !== \"supported\" && event.data !== \"unsupported\") {\n                    return;\n                } else if (event.data === \"unsupported\") {\n                    loginIframe.enable = false;\n                    if (kc.silentCheckSsoFallback) {\n                        kc.silentCheckSsoRedirectUri = false;\n                    }\n                    logWarn(\"[KEYCLOAK] 3rd party cookies aren't supported by this browser. checkLoginIframe and \" +\n                        \"silent check-sso are not available.\");\n                }\n\n                document.body.removeChild(iframe);\n                window.removeEventListener(\"message\", messageCallback);\n                promise.setSuccess();\n            };\n\n            window.addEventListener('message', messageCallback, false);\n        } else {\n            promise.setSuccess();\n        }\n\n        return applyTimeoutToPromise(promise.promise, kc.messageReceiveTimeout, \"Timeout when waiting for 3rd party check iframe message.\");\n    }\n\n    function loadAdapter(type) {\n        if (!type || type == 'default') {\n            return {\n                login: function(options) {\n                    window.location.assign(kc.createLoginUrl(options));\n                    return createPromise().promise;\n                },\n\n                logout: function(options) {\n                    window.location.replace(kc.createLogoutUrl(options));\n                    return createPromise().promise;\n                },\n\n                register: function(options) {\n                    window.location.assign(kc.createRegisterUrl(options));\n                    return createPromise().promise;\n                },\n\n                accountManagement : function() {\n                    var accountUrl = kc.createAccountUrl();\n                    if (typeof accountUrl !== 'undefined') {\n                        window.location.href = accountUrl;\n                    } else {\n                        throw \"Not supported by the OIDC server\";\n                    }\n                    return createPromise().promise;\n                },\n\n                redirectUri: function(options, encodeHash) {\n\n                    if (options && options.redirectUri) {\n                        return options.redirectUri;\n                    } else if (kc.redirectUri) {\n                        return kc.redirectUri;\n                    } else {\n                        return location.href;\n                    }\n                }\n            };\n        }\n\n        if (type == 'cordova') {\n            loginIframe.enable = false;\n            var cordovaOpenWindowWrapper = function(loginUrl, target, options) {\n                if (window.cordova && window.cordova.InAppBrowser) {\n                    // Use inappbrowser for IOS and Android if available\n                    return window.cordova.InAppBrowser.open(loginUrl, target, options);\n                } else {\n                    return window.open(loginUrl, target, options);\n                }\n            };\n\n            var shallowCloneCordovaOptions = function (userOptions) {\n                if (userOptions && userOptions.cordovaOptions) {\n                    return Object.keys(userOptions.cordovaOptions).reduce(function (options, optionName) {\n                        options[optionName] = userOptions.cordovaOptions[optionName];\n                        return options;\n                    }, {});\n                } else {\n                    return {};\n                }\n            };\n\n            var formatCordovaOptions = function (cordovaOptions) {\n                return Object.keys(cordovaOptions).reduce(function (options, optionName) {\n                    options.push(optionName+\"=\"+cordovaOptions[optionName]);\n                    return options;\n                }, []).join(\",\");\n            };\n\n            var createCordovaOptions = function (userOptions) {\n                var cordovaOptions = shallowCloneCordovaOptions(userOptions);\n                cordovaOptions.location = 'no';\n                if (userOptions && userOptions.prompt == 'none') {\n                    cordovaOptions.hidden = 'yes';\n                }\n                return formatCordovaOptions(cordovaOptions);\n            };\n\n            var cordovaRedirectUri = kc.redirectUri || 'http://localhost';\n            \n            return {\n                login: function(options) {\n                    var promise = createPromise();\n\n                    var cordovaOptions = createCordovaOptions(options);\n                    var loginUrl = kc.createLoginUrl(options);\n                    var ref = cordovaOpenWindowWrapper(loginUrl, '_blank', cordovaOptions);\n                    var completed = false;\n\n                    var closed = false;\n                    var closeBrowser = function() {\n                        closed = true;\n                        ref.close();\n                    };\n\n                    ref.addEventListener('loadstart', function(event) {\n                        if (event.url.indexOf(cordovaRedirectUri) == 0) {\n                            var callback = parseCallback(event.url);\n                            processCallback(callback, promise);\n                            closeBrowser();\n                            completed = true;\n                        }\n                    });\n\n                    ref.addEventListener('loaderror', function(event) {\n                        if (!completed) {\n                            if (event.url.indexOf(cordovaRedirectUri) == 0) {\n                                var callback = parseCallback(event.url);\n                                processCallback(callback, promise);\n                                closeBrowser();\n                                completed = true;\n                            } else {\n                                promise.setError();\n                                closeBrowser();\n                            }\n                        }\n                    });\n\n                    ref.addEventListener('exit', function(event) {\n                        if (!closed) {\n                            promise.setError({\n                                reason: \"closed_by_user\"\n                            });\n                        }\n                    });\n\n                    return promise.promise;\n                },\n\n                logout: function(options) {\n                    var promise = createPromise();\n\n                    var logoutUrl = kc.createLogoutUrl(options);\n                    var ref = cordovaOpenWindowWrapper(logoutUrl, '_blank', 'location=no,hidden=yes,clearcache=yes');\n\n                    var error;\n\n                    ref.addEventListener('loadstart', function(event) {\n                        if (event.url.indexOf(cordovaRedirectUri) == 0) {\n                            ref.close();\n                        }\n                    });\n\n                    ref.addEventListener('loaderror', function(event) {\n                        if (event.url.indexOf(cordovaRedirectUri) == 0) {\n                            ref.close();\n                        } else {\n                            error = true;\n                            ref.close();\n                        }\n                    });\n\n                    ref.addEventListener('exit', function(event) {\n                        if (error) {\n                            promise.setError();\n                        } else {\n                            kc.clearToken();\n                            promise.setSuccess();\n                        }\n                    });\n\n                    return promise.promise;\n                },\n\n                register : function(options) {\n                    var promise = createPromise();\n                    var registerUrl = kc.createRegisterUrl();\n                    var cordovaOptions = createCordovaOptions(options);\n                    var ref = cordovaOpenWindowWrapper(registerUrl, '_blank', cordovaOptions);\n                    ref.addEventListener('loadstart', function(event) {\n                        if (event.url.indexOf(cordovaRedirectUri) == 0) {\n                            ref.close();\n                            var oauth = parseCallback(event.url);\n                            processCallback(oauth, promise);\n                        }\n                    });\n                    return promise.promise;\n                },\n\n                accountManagement : function() {\n                    var accountUrl = kc.createAccountUrl();\n                    if (typeof accountUrl !== 'undefined') {\n                        var ref = cordovaOpenWindowWrapper(accountUrl, '_blank', 'location=no');\n                        ref.addEventListener('loadstart', function(event) {\n                            if (event.url.indexOf(cordovaRedirectUri) == 0) {\n                                ref.close();\n                            }\n                        });\n                    } else {\n                        throw \"Not supported by the OIDC server\";\n                    }\n                },\n\n                redirectUri: function(options) {\n                    return cordovaRedirectUri;\n                }\n            }\n        }\n\n        if (type == 'cordova-native') {\n            loginIframe.enable = false;\n\n            return {\n                login: function(options) {\n                    var promise = createPromise();\n                    var loginUrl = kc.createLoginUrl(options);\n\n                    universalLinks.subscribe('keycloak', function(event) {\n                        universalLinks.unsubscribe('keycloak');\n                        window.cordova.plugins.browsertab.close();\n                        var oauth = parseCallback(event.url);\n                        processCallback(oauth, promise);\n                    });\n\n                    window.cordova.plugins.browsertab.openUrl(loginUrl);\n                    return promise.promise;\n                },\n\n                logout: function(options) {\n                    var promise = createPromise();\n                    var logoutUrl = kc.createLogoutUrl(options);\n\n                    universalLinks.subscribe('keycloak', function(event) {\n                        universalLinks.unsubscribe('keycloak');\n                        window.cordova.plugins.browsertab.close();\n                        kc.clearToken();\n                        promise.setSuccess();\n                    });\n\n                    window.cordova.plugins.browsertab.openUrl(logoutUrl);\n                    return promise.promise;\n                },\n\n                register : function(options) {\n                    var promise = createPromise();\n                    var registerUrl = kc.createRegisterUrl(options);\n                    universalLinks.subscribe('keycloak' , function(event) {\n                        universalLinks.unsubscribe('keycloak');\n                        window.cordova.plugins.browsertab.close();\n                        var oauth = parseCallback(event.url);\n                        processCallback(oauth, promise);\n                    });\n                    window.cordova.plugins.browsertab.openUrl(registerUrl);\n                    return promise.promise;\n\n                },\n\n                accountManagement : function() {\n                    var accountUrl = kc.createAccountUrl();\n                    if (typeof accountUrl !== 'undefined') {\n                        window.cordova.plugins.browsertab.openUrl(accountUrl);\n                    } else {\n                        throw \"Not supported by the OIDC server\";\n                    }\n                },\n\n                redirectUri: function(options) {\n                    if (options && options.redirectUri) {\n                        return options.redirectUri;\n                    } else if (kc.redirectUri) {\n                        return kc.redirectUri;\n                    } else {\n                        return \"http://localhost\";\n                    }\n                }\n            }\n        }\n\n        throw 'invalid adapter type: ' + type;\n    }\n\n    var LocalStorage = function() {\n        if (!(this instanceof LocalStorage)) {\n            return new LocalStorage();\n        }\n\n        localStorage.setItem('kc-test', 'test');\n        localStorage.removeItem('kc-test');\n\n        var cs = this;\n\n        function clearExpired() {\n            var time = new Date().getTime();\n            for (var i = 0; i < localStorage.length; i++)  {\n                var key = localStorage.key(i);\n                if (key && key.indexOf('kc-callback-') == 0) {\n                    var value = localStorage.getItem(key);\n                    if (value) {\n                        try {\n                            var expires = JSON.parse(value).expires;\n                            if (!expires || expires < time) {\n                                localStorage.removeItem(key);\n                            }\n                        } catch (err) {\n                            localStorage.removeItem(key);\n                        }\n                    }\n                }\n            }\n        }\n\n        cs.get = function(state) {\n            if (!state) {\n                return;\n            }\n\n            var key = 'kc-callback-' + state;\n            var value = localStorage.getItem(key);\n            if (value) {\n                localStorage.removeItem(key);\n                value = JSON.parse(value);\n            }\n\n            clearExpired();\n            return value;\n        };\n\n        cs.add = function(state) {\n            clearExpired();\n\n            var key = 'kc-callback-' + state.state;\n            state.expires = new Date().getTime() + (60 * 60 * 1000);\n            localStorage.setItem(key, JSON.stringify(state));\n        };\n    };\n\n    var CookieStorage = function() {\n        if (!(this instanceof CookieStorage)) {\n            return new CookieStorage();\n        }\n\n        var cs = this;\n\n        cs.get = function(state) {\n            if (!state) {\n                return;\n            }\n\n            var value = getCookie('kc-callback-' + state);\n            setCookie('kc-callback-' + state, '', cookieExpiration(-100));\n            if (value) {\n                return JSON.parse(value);\n            }\n        };\n\n        cs.add = function(state) {\n            setCookie('kc-callback-' + state.state, JSON.stringify(state), cookieExpiration(60));\n        };\n\n        cs.removeItem = function(key) {\n            setCookie(key, '', cookieExpiration(-100));\n        };\n\n        var cookieExpiration = function (minutes) {\n            var exp = new Date();\n            exp.setTime(exp.getTime() + (minutes*60*1000));\n            return exp;\n        };\n\n        var getCookie = function (key) {\n            var name = key + '=';\n            var ca = document.cookie.split(';');\n            for (var i = 0; i < ca.length; i++) {\n                var c = ca[i];\n                while (c.charAt(0) == ' ') {\n                    c = c.substring(1);\n                }\n                if (c.indexOf(name) == 0) {\n                    return c.substring(name.length, c.length);\n                }\n            }\n            return '';\n        };\n\n        var setCookie = function (key, value, expirationDate) {\n            var cookie = key + '=' + value + '; '\n                + 'expires=' + expirationDate.toUTCString() + '; ';\n            document.cookie = cookie;\n        };\n    };\n\n    function createCallbackStorage() {\n        try {\n            return new LocalStorage();\n        } catch (err) {\n        }\n\n        return new CookieStorage();\n    }\n\n    function createLogger(fn) {\n        return function() {\n            if (kc.enableLogging) {\n                fn.apply(console, Array.prototype.slice.call(arguments));\n            }\n        };\n    }\n}\n\nexport { Keycloak as default };\n"]},"metadata":{},"sourceType":"module"}